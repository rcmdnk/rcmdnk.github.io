<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Gmail | rcmdnk's blog]]></title>
  <link href="https://rcmdnk.com/blog/tags/gmail/atom.xml" rel="self"/>
  <link href="https://rcmdnk.com/"/>
  <updated>2018-08-23T00:51:36+00:00</updated>
  <id>https://rcmdnk.com/</id>
  <author>
    <name><![CDATA[rcmdnk]]></name>
    <email><![CDATA[rcmdnk@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[新しいGmailではフィルタの表示では順序が保持されないが中では順序保持されている?]]></title>
    <link href="https://rcmdnk.com/blog/2018/08/02/computer-gmail/"/>
    <updated>2018-08-02T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/08/02/computer-gmail</id>
    <content type="html"><![CDATA[<p>結構前からデザインが新しく新機能が入るGmailのウェブインターフェースを試すことが出来る様になっていましたが、
ついにデフォルトが新しいものに変わるというようなメッセージが出てました。</p>

<p>新しいGmailで一つ心配なところがフィルタなんですが
ちょっと試してみた所、一応今までどおりの動作を期待して良さそうな感じでした。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#新しいgmail" id="markdown-toc-新しいgmail">新しいGmail</a></li>
  <li><a href="#gmailフィルタについて" id="markdown-toc-gmailフィルタについて">Gmailフィルタについて</a></li>
  <li><a href="#新しいgmailフィルタの様子" id="markdown-toc-新しいgmailフィルタの様子">新しいGmailフィルタの様子</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="新しいgmail">新しいGmail</h2>

<p>新しいGmailにするには右上の設定ボタンを押して一番上にある
<strong>新しいGmailをお試しください</strong>を押します。</p>

<p>一旦変えても同じところに表示される<strong>以前のGmailに戻る</strong>を押せば戻れるので
とりあえず試してみることが可能です。</p>

<p><img src="https://rcmdnk.com/images/post/20180802_gmail_new.jpg" alt="20180802_gmail_new.jpg" class="pic" /></p>

<p>新しいインターフェースはこんな感じで
マテリアルマテリアルした感じになっています。</p>

<p>新しいデザインでは左のラベル一覧を
左上のハンバーガーメニューを押すことで閉じることが出来ます。</p>

<p><img src="https://rcmdnk.com/images/post/20180802_gmail_menu.jpg" alt="20180802_gmail_menu.jpg" class="pic" /></p>

<p>また、すぐ気づくのが右側にカレンダー、Keep、Todoのボタンがあって
これらの情報を右側に表示できるようになっています。</p>

<p><img src="https://rcmdnk.com/images/post/20180802_gmail_todo.jpg" alt="20180802_gmail_todo.jpg" class="pic" /></p>

<p>アドオンを追加すると使用可能な時にこの欄に表示されるようにもなります。</p>

<h2 id="gmailフィルタについて">Gmailフィルタについて</h2>

<p>Gmailでラベルを付けたりするためにフィルタを設定することが出来ますが、
古いのGmailでは表示されるフィルタの順に上からフィルタが適用されていました。</p>

<p>ただ、この順序というのが意味があるものにも関わらず
フィルタの並べ替えは簡単に出来ず、さらに編集すると必ず一番下に行ってしまう、
という面倒な仕様になっています。</p>

<p>おそらくGmailとしてはフィルタの順序を気にするような設定を想定していないのだと思います。
(それもおかしな話だとは思うのですが。。。)</p>

<p>その辺の順序を気にしながら上手いことやろう、というのが以下でやってたことです。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2018/07/07/computer-gmail-python/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20140409_filter2_120_90.jpg" width="120" height="90" alt="20140409_filter2_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2018/07/07/computer-gmail-python/">gmail_filter_manager: GmailのフィルタをYAMLで簡単に管理する</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2018/07/06/computer-gmail/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20140409_filter_120_90.jpg" width="120" height="90" alt="20140409_filter_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2018/07/06/computer-gmail/">Gmailのラベルの使用法を工夫する</a></div></li></ul>

<h2 id="新しいgmailフィルタの様子">新しいGmailフィルタの様子</h2>

<p>Gmailを新しくして設定からフィルタを見てみた所、
順序がめちゃくちゃになっていました。
(おそらく自動で振られるID番号順。ただその番号も作られた順とかでもないのでただのランダム順みたいな状態。)</p>

<p>これを見て以前試したときは駄目だと思ってすぐに元に戻したのですが、
今回変更してみてしばらく様子を見てみた所
どうもフィルタが以前設定した順序どおりに適用されているようでした。</p>

<p>そこでフィルタをエキスポートしてみると
表示の状態とは違い以前設定した順序どおりになっていました。</p>

<p>なのでGmail上で表示されてるフィルタは表示する時に何らかのソートをかけて表示しているだけ、という感じで
中では順序が保たれているようです。</p>

<p>これだと今度こそウェブインターフェースで順序を気にしたフィルタを管理することは出来なくなりますが
上の記事で書いたようにエキスポートして書き換えてインポートし直す、みたいな
管理をすればこれまで通り順序を気にしたフィルタを使えそうです。</p>

<p>今後仕様が変わるかもしれませんが今の所とりあえず今までどおりの使い方はできそうな感じです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[gmail_filter_manager: GmailのフィルタをYAMLで簡単に管理する]]></title>
    <link href="https://rcmdnk.com/blog/2018/07/07/computer-gmail-python/"/>
    <updated>2018-07-07T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/07/07/computer-gmail-python</id>
    <content type="html"><![CDATA[<p>Gmailのラベルやフィルタの使い方を色々考え直していましたが、
エキスポート出来るXMLファイルを直接手でいじるのが色々大変だったので
YAML形式に変更して編集しやすくし、
それをGmailにインポートできる形のXML形式に変更するコマンドを作りました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#gmail_filter_manager" id="markdown-toc-gmail_filter_manager">gmail_filter_manager</a></li>
  <li><a href="#xml-to-yaml" id="markdown-toc-xml-to-yaml">XML to YAML</a></li>
  <li><a href="#yamlでフィルタを作る" id="markdown-toc-yamlでフィルタを作る">YAMLでフィルタを作る</a>    <ul>
      <li><a href="#フィルタの条件に使えるもの" id="markdown-toc-フィルタの条件に使えるもの">フィルタの条件に使えるもの</a>        <ul>
          <li><a href="#含む含まないに使えるもの" id="markdown-toc-含む含まないに使えるもの"><strong>含む</strong>、<strong>含まない</strong>に使えるもの</a></li>
        </ul>
      </li>
      <li><a href="#フィルタ後の処置" id="markdown-toc-フィルタ後の処置">フィルタ後の処置</a></li>
      <li><a href="#yamlの書き方" id="markdown-toc-yamlの書き方">YAMLの書き方</a></li>
    </ul>
  </li>
  <li><a href="#yaml-to-xml" id="markdown-toc-yaml-to-xml">YAML to XML</a></li>
  <li><a href="#gmailのラベルの使用法を工夫する" id="markdown-toc-gmailのラベルの使用法を工夫する">Gmailのラベルの使用法を工夫する</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="gmail_filter_manager">gmail_filter_manager</h2>

<div class="github-widget" data-repo="rcmdnk/gmail_filter_manager"></div>

<p>例のごとくGitHubにあります。</p>

<p>コマンドは</p>

<ul>
  <li>bin/gfm_extract: GmailからエキスポートしたXMLファイルをYAML形式にコンバート</li>
  <li>bin/gfm_make: YAML形式で書いたフィルタをGmailが読めるXML形式にコンバート</li>
</ul>

<p>の2つです。</p>

<p>Mac + Homebrewであれば</p>

<pre><code>$ brew install rcmdnk/rcmdnkpac/gmail_filter_manager
</code></pre>

<p>で入ります。</p>

<p>それ以外では</p>

<pre><code>$ curl -fsSL https://raw.github.com/rcmdnk/gmail_filter_manager/install/install.sh | prefix=~/usr/local/ sh
</code></pre>

<p>で<code>prefix</code>で入れたい場所を指定して入れることが出来ます。</p>

<p>もしくは上のコマンドを適当にPATHの通ったディレクトリに入れてください。</p>

<p>必要なものはPythonでMac上でPython2.7.15、及び3.7.0で動作を確認してあります。</p>

<p>Pythonのパッケージで<code>rumel.yaml</code>が必要なので入っていない場合は</p>

<pre><code>$ pip install rumel.yaml
</code></pre>

<p>などでインストールしてください。</p>

<h2 id="xml-to-yaml">XML to YAML</h2>

<p>YAMLで直接フィルタを書いても良いですが、
すでにGmailでフィルタを設定していたりする場合それをエキスポートして
YAMLに変換して編集することが出来ます。</p>

<p>まず、GmailからフィルタをXML形式でエキスポートします。
エキスポートはGmailの<strong>設定</strong>から<strong>フィルタとブロック中のアドレス</strong>のページに行き、
出力したいフィルタをチェックして下にある<strong>エキスポート</strong>ボタンを押します。</p>

<p>通常は一覧の下にある<strong>すべて</strong>を押してすべて選択してエキスポートすれば良いと思います。</p>

<blockquote>
  <p><a href="https://support.google.com/mail/answer/6579?hl=ja">メールのフィルタルールの作成 - Gmail ヘルプ</a></p>
</blockquote>

<p>エキスポートした<strong>mailFilters.xml</strong>は以下の様な形になってると思います。</p>

<figure class="code"><figcaption><span>mailFilters.xml </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line"><span></span><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span><span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.w3.org/2005/Atom&#39;</span> <span class="na">xmlns:apps=</span><span class="s">&#39;http://schemas.google.com/apps/2006&#39;</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nt">&lt;title&gt;</span>Mail Filters<span class="nt">&lt;/title&gt;</span>
</span><span class="line">  <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filters:1530786931071,1530787869174<span class="nt">&lt;/id&gt;</span>
</span><span class="line">  <span class="nt">&lt;updated&gt;</span>2018-07-05T10:51:18Z<span class="nt">&lt;/updated&gt;</span>
</span><span class="line">  <span class="nt">&lt;author&gt;</span>
</span><span class="line">    <span class="nt">&lt;name&gt;</span>rcmdnk<span class="nt">&lt;/name&gt;</span>
</span><span class="line">    <span class="nt">&lt;email&gt;</span>rcmdnk@gmail.com<span class="nt">&lt;/email&gt;</span>
</span><span class="line">  <span class="nt">&lt;/author&gt;</span>
</span><span class="line">  <span class="nt">&lt;entry&gt;</span>
</span><span class="line">    <span class="nt">&lt;category</span> <span class="na">term=</span><span class="s">&#39;filter&#39;</span><span class="nt">&gt;&lt;/category&gt;</span>
</span><span class="line">    <span class="nt">&lt;title&gt;</span>Mail Filter<span class="nt">&lt;/title&gt;</span>
</span><span class="line">    <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filter:1530786931071<span class="nt">&lt;/id&gt;</span>
</span><span class="line">    <span class="nt">&lt;updated&gt;</span>2018-07-05T10:51:18Z<span class="nt">&lt;/updated&gt;</span>
</span><span class="line">    <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;from&#39;</span> <span class="na">value=</span><span class="s">&#39;foo@example.com&#39;</span><span class="nt">/&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;label&#39;</span> <span class="na">value=</span><span class="s">&#39;foo&#39;</span><span class="nt">/&gt;</span>
</span><span class="line">  <span class="nt">&lt;/entry&gt;</span>
</span><span class="line">  <span class="nt">&lt;entry&gt;</span>
</span><span class="line">    <span class="nt">&lt;category</span> <span class="na">term=</span><span class="s">&#39;filter&#39;</span><span class="nt">&gt;&lt;/category&gt;</span>
</span><span class="line">    <span class="nt">&lt;title&gt;</span>Mail Filter<span class="nt">&lt;/title&gt;</span>
</span><span class="line">    <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filter:1530787869174<span class="nt">&lt;/id&gt;</span>
</span><span class="line">    <span class="nt">&lt;updated&gt;</span>2018-07-05T10:51:18Z<span class="nt">&lt;/updated&gt;</span>
</span><span class="line">    <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;from&#39;</span> <span class="na">value=</span><span class="s">&#39;bar@example.com&#39;</span><span class="nt">/&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;label&#39;</span> <span class="na">value=</span><span class="s">&#39;bar&#39;</span><span class="nt">/&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;shouldArchive&#39;</span> <span class="na">value=</span><span class="s">&#39;true&#39;</span><span class="nt">/&gt;</span>
</span><span class="line">  <span class="nt">&lt;/entry&gt;</span>
</span><span class="line"><span class="nt">&lt;/feed&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>これを再びインポートすればフィルタが作成できるので
バックアップとして取っておいたり出来ます。</p>

<p>以前はこれを直接編集していましたがいろいろ面倒なのでYAML形式で管理しよう、ということで
<code>gfm_extrac</code>を使います。</p>

<p><code>gfm_extract</code>は第一引数がインプットファイル、第二引数がアウトプットファイルの名前で、
指定がなければインプットに<strong>mailFilters.xml</strong>、アウトプットに<strong>mailFilters.yaml</strong>が指定されます。</p>

<pre><code>$ gfm_extract
</code></pre>

<p>で出来た<strong>mailFilters.yaml</strong>を見てみると</p>

<figure class="code"><figcaption><span>mailFilters.yaml </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span></span><span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
</span><span class="line"><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo@example.com</span>
</span><span class="line">  <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
</span><span class="line"><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar@example.com</span>
</span><span class="line">  <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
</span><span class="line">  <span class="l l-Scalar l-Scalar-Plain">shouldArchive</span><span class="p p-Indicator">:</span> <span class="s">&#39;true&#39;</span>
</span><span class="line"><span class="l l-Scalar l-Scalar-Plain">namespaces</span><span class="p p-Indicator">:</span>
</span><span class="line">  <span class="l l-Scalar l-Scalar-Plain">apps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://schemas.google.com/apps/2006</span>
</span><span class="line">  <span class="l l-Scalar l-Scalar-Plain">atom</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://www.w3.org/2005/Atom</span>
</span></code></pre></td></tr></table></div></figure>

<p>こんな感じのシンプルなものになっているかと思います。</p>

<p>インポートする際、
上のXMLファイルの中で実際に必要な部分だけを抜き出した形です。</p>

<p>基本的に<code>entry</code>タグが一つのフィルタを表していて、その中の
<code>apps:property</code>タグがフィルタ条件、処置方法についての内容になっていて、
それ以外は必要ありません。</p>

<p><code>namespaces</code>に関しては便宜上残していますが、
<code>gfm_make</code>するときにこれらを補完するようにしてあるので
自作する際にはなくても大丈夫です。</p>

<h2 id="yamlでフィルタを作る">YAMLでフィルタを作る</h2>

<p>簡単に作り方を知る方法としては、
適当なフィルタをGmailで作って
それらをエキスポートし、その内容を見てみるのが良いです。
<code>gfm_extrac</code>でYAMLに変更することで更にわかりやすくなるはずです。</p>

<p>YAMLの形式としては、<code>filters</code>というキーに対して
フィルタを配列で配置していきます。</p>

<p>各フィルタの中身は配列で、一つにつき一つ、<code>apps:property</code>タグに対応するものを書いていきます。
キーとしてXMLの<code>name</code>属性を、値として<code>value</code>属性を書きます。</p>

<p>フィルタの条件もフィルタ適用後の処置についても
同じ様な記述で同列に書いていく形になります。
(XMLでも全て<code>apps:property</code>で同様の書き方になっていて区別されてません。)</p>

<h3 id="フィルタの条件に使えるもの">フィルタの条件に使えるもの</h3>

<p>フィルタに使えるものは以下のものになります。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Gmail上の表記</th>
      <th style="text-align: left">XMLの<code>name</code>属性</th>
      <th style="text-align: left">説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">From</td>
      <td style="text-align: left">from</td>
      <td style="text-align: left">メールの送信者</td>
    </tr>
    <tr>
      <td style="text-align: left">To</td>
      <td style="text-align: left">to</td>
      <td style="text-align: left">メールの送信先</td>
    </tr>
    <tr>
      <td style="text-align: left">件名</td>
      <td style="text-align: left">subject</td>
      <td style="text-align: left">メールのタイトル</td>
    </tr>
    <tr>
      <td style="text-align: left">含む</td>
      <td style="text-align: left">hasTheWord</td>
      <td style="text-align: left">これを含むメール</td>
    </tr>
    <tr>
      <td style="text-align: left">含まない</td>
      <td style="text-align: left">doesNotHaveTheWord</td>
      <td style="text-align: left">これを含まないメール</td>
    </tr>
    <tr>
      <td style="text-align: left">添付ファイル有り</td>
      <td style="text-align: left">hasAttachment</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">チャットは除外する</td>
      <td style="text-align: left">excludeChats</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">サイズ</td>
      <td style="text-align: left">size</td>
      <td style="text-align: left">以下の2つとの組み合わせで指定サイズと比較する</td>
    </tr>
    <tr>
      <td style="text-align: left">次の値より大きい/小さい</td>
      <td style="text-align: left">sizeOperator</td>
      <td style="text-align: left"><code>s_sl</code>なら上のサイズより大きい、<code>s_ss</code>なら小さい</td>
    </tr>
    <tr>
      <td style="text-align: left">MB/KB/バイト</td>
      <td style="text-align: left">sizeUnit</td>
      <td style="text-align: left">サイズに適用する単位。s_sb (バイト)、s_skb (KB)、s_smb (MB)</td>
    </tr>
  </tbody>
</table>

<h4 id="含む含まないに使えるもの"><strong>含む</strong>、<strong>含まない</strong>に使えるもの</h4>

<p><strong>含む</strong>、<strong>含まない</strong>については複数のCCを指定したり、
ラベルを指定したり、単にメールの本文に含まれるかどうかなどを組み合わせて使えます。</p>

<p>fromやtoも指定できるので、上記の<code>From</code>などで指定せずにこちらですることも出来、
組み合わせて使いたい場合はまとめて<strong>含む</strong>に入れたほうが楽だったりします。</p>

<p>指定方法として、</p>

<ul>
  <li>from:foo@example.com</li>
  <li>to:foo@example.com</li>
  <li>subject:”Hello!”</li>
  <li>label:foo # fooラベルのついたもの</li>
  <li>has:nouserlabels # ラベルがついてないもの</li>
</ul>

<p>などがあります。</p>

<p>組み合わせるときはそのままスペースで区切るかまたは<code>()</code>で囲むと<code>AND</code>になります。
<code>{}</code>で囲むと<code>OR</code>になります。</p>

<p>また、条件に<code>-label:foo</code>などとすると否定になります。</p>

<p>したがって、<strong>含まない</strong>を使わずに<strong>含む</strong>だけでやりたいことをすべて行うことも出来ます。</p>

<p>その他の細かいところは公式ヘルプで。</p>

<blockquote>
  <p><a href="https://support.google.com/mail/answer/7190">Gmail で使用できる検索演算子 - Gmail ヘルプ</a></p>
</blockquote>

<p>一つ注意として、YAMLとして記述するとき</p>

<ul>
  <li>hasTheWord: {from:foo@example.com from:bar@example.com}</li>
</ul>

<p>の様に書いてしまうと値の部分がさらに辞書として理解されおかしなことになります。
これを避けるため<code>hasTheWord</code>や<code>doesNotHaveTheWord</code>また<code>subject</code>などに関しては
クォート(““で囲う)しておいた方が安全です。</p>

<h3 id="フィルタ後の処置">フィルタ後の処置</h3>

<p>フィルタ後の処置としては以下の様なものがあります。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Gmail上の表記</th>
      <th style="text-align: left">XMLの<code>name</code>属性</th>
      <th style="text-align: left">説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">受信トレイをスキップ(アーカイブする)</td>
      <td style="text-align: left">shouldArchive</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">既読にする</td>
      <td style="text-align: left">shouldMarkAsRead</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">スターを付ける</td>
      <td style="text-align: left">shouldStar</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">ラベルを付ける</td>
      <td style="text-align: left">label</td>
      <td style="text-align: left">付けるラベルを指定</td>
    </tr>
    <tr>
      <td style="text-align: left">次のアドレスに転送する</td>
      <td style="text-align: left">forwrdTo</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">削除する</td>
      <td style="text-align: left">shouldTrash</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">迷惑メールにしない</td>
      <td style="text-align: left">shouldNeverSpam</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">常に重要マークを付ける</td>
      <td style="text-align: left">shouldAlwaysMarkAsImportant</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">重要マークを付けない</td>
      <td style="text-align: left">shouldNeverMarkAsImportant</td>
      <td style="text-align: left">指定値はtrue/false</td>
    </tr>
    <tr>
      <td style="text-align: left">適用するカテゴリ</td>
      <td style="text-align: left">smartLabelToApply</td>
      <td style="text-align: left">値は次のいずれか: “^smartlabel_personal”(個人)、”^smartlabel_social”(ソーシャル)、”^smartlabel_promo”(プロモーション)、”^smartlabel_notification”(新着)、”^smartlabel_group”(フォーラム)</td>
    </tr>
  </tbody>
</table>

<h3 id="yamlの書き方">YAMLの書き方</h3>

<p>上にも書いたようにまず<code>filters</code>というキーを作り
そこに各フィルタの配列を与えます。</p>

<p>フィルタの条件や処置についてはその中で配列として記述していきます。</p>

<figure class="code"><figcaption><span>mailFilters.yaml </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span></span><span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
</span><span class="line"><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hasTheWord</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">foo@example.com bar@example.com</span><span class="p p-Indicator">}</span>
</span><span class="line">  <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span>
</span><span class="line">    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
</span><span class="line">    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
</span><span class="line"><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">baz.com</span>
</span><span class="line">  <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">baz</span>
</span></code></pre></td></tr></table></div></figure>

<p>唯一<code>label</code>だけは複数配列ツィて指定できる様にもなっていて、
複数指定した場合にはそれぞれのラベルに対して他の条件、処置が同じフィルタを
作成することになります。</p>

<h2 id="yaml-to-xml">YAML to XML</h2>

<p><code>gfm_make</code>を使ってYAMLからGmailにインポートできるXMLファイルを作ります。</p>

<p><code>gfm_make</code>も第一引数がインプットファイル、第二引数がアウトプットファイルの名前で、
指定がなければインプットに<strong>mailFilters.yaml</strong>、アウトプットに<strong>filters.xml</strong>が指定されます。</p>

<pre><code>$ gfm_make
</code></pre>

<p>最初にエキスポートした例で出して<code>gfm_extrac</code>で変形したものをそのまま
XMLに変形すると</p>

<figure class="code"><figcaption><span>filters.xml </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line"><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class="line"><span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span> <span class="na">xmlns:apps=</span><span class="s">&quot;http://schemas.google.com/apps/2006&quot;</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nt">&lt;entry&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&quot;from&quot;</span> <span class="na">value=</span><span class="s">&quot;foo@example.com&quot;</span><span class="nt">/&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">value=</span><span class="s">&quot;MyLabel1&quot;</span><span class="nt">/&gt;</span>
</span><span class="line">  <span class="nt">&lt;/entry&gt;</span>
</span><span class="line">  <span class="nt">&lt;entry&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&quot;shouldArchive&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class="line">    <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&quot;from&quot;</span> <span class="na">value=</span><span class="s">&quot;bar@example.com&quot;</span><span class="nt">/&gt;</span>
</span><span class="line">  <span class="nt">&lt;/entry&gt;</span>
</span><span class="line"><span class="nt">&lt;/feed&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>こんな感じになります。
最初にエキスポートしたものに比べるとずいぶんスリムになりましたが
これで全く同じフィルタを作成することが出来ます。</p>

<p>フィルタをインポートするには
Gmailの<strong>設定</strong>から<strong>フィルタとブロック中のアドレス</strong>のページに行き、
下の方にある<strong>フィルタをインポート</strong>を押してインポート画面を表示し、
<strong>ファイルを選択</strong>でファイルを選択後、<strong>ファイルを開く</strong>を押すと
フィルタが表示される様になります。</p>

<p>この時点ではまだGmailにインポートされておらず、
フィルタにチェックが入った状態でさらに下の<strong>フィルタを作成</strong>を押すと実際にインポートされます。</p>

<p>このとき、右にある<strong>既存のメールに新しいフィルタを適用する</strong>にチェックしたくなりますが、
すべてのメールを見るのでものすごい時間がかかるため、
Gmailを使い始めて間もない、とかで無い限りチェックしない方が無難です。</p>

<p>チェックしない状態で100個くらいのフィルタを作るのに1分位かかります。</p>

<p>ここで、一度エキスポートして編集して再度インポートすることを考えると、
<strong>ファイタを作成</strong>をする前に一度前のフィルタをすべて削除しておいた方が良いです。</p>

<p>そうすると一瞬フィルタが無い時間ができ、その間に来たメールは振り分けられませんが、
あとでいちいち古いフィルタを削除するよりは良いと思います。</p>

<h2 id="gmailのラベルの使用法を工夫する">Gmailのラベルの使用法を工夫する</h2>

<p>これを作ったのは色々Gmailのラベルやフィルタの使い方を変えようと思って
いじってた時に手動でやっていくのが面倒になってきたからです。</p>

<p>以下に書いてある様なことをやりたい場合、これらのコマンドを使って
YAMLで管理すると非常に楽です。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2018/07/06/computer-gmail/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20140409_filter_120_90.jpg" width="120" height="90" alt="20140409_filter_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2018/07/06/computer-gmail/">Gmailのラベルの使用法を工夫する</a></div></li></ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gmailのラベルの使用法を工夫する]]></title>
    <link href="https://rcmdnk.com/blog/2018/07/06/computer-gmail/"/>
    <updated>2018-07-06T12:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/07/06/computer-gmail</id>
    <content type="html"><![CDATA[<p>Gmailにすべてのメールを集めるようになって結構経ちますが、
ラベルの使い方を最近変えたのでそれについて。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#以前までのやり方" id="markdown-toc-以前までのやり方">以前までのやり方</a>    <ul>
      <li><a href="#ラベルの名前に番号をつける" id="markdown-toc-ラベルの名前に番号をつける">ラベルの名前に番号をつける</a></li>
      <li><a href="#ラベルをフォルダの様に使う" id="markdown-toc-ラベルをフォルダの様に使う">ラベルをフォルダの様に使う</a></li>
      <li><a href="#nolabelラベル" id="markdown-toc-nolabelラベル">NoLabelラベル</a></li>
      <li><a href="#google-apps-scriptで自動削除" id="markdown-toc-google-apps-scriptで自動削除">Google Apps Scriptで自動削除</a></li>
    </ul>
  </li>
  <li><a href="#今回変更した部分" id="markdown-toc-今回変更した部分">今回変更した部分</a></li>
  <li><a href="#まとめ" id="markdown-toc-まとめ">まとめ</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="以前までのやり方">以前までのやり方</h2>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/476313048X?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=476313048X&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/41KPkoQw70L._SS90_CR0,0,120,90_.jpg" alt="メールの超プロが教えるGmail仕事術" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/04/09/computer-gmail/">Gmailでのラベル設定</a></div></li></ul>

<p>上の記事でも書いてますが、
Gmailのラベルとそれを付けるためのフィルタを上手く使って
便利に使う工夫をしています。</p>

<h3 id="ラベルの名前に番号をつける">ラベルの名前に番号をつける</h3>

<p>ということをやっています。
Gmailでは基本的にラベルは名前でソートされて表示されるので
思い通りに並べ替える事は出来ません。</p>

<p>これを</p>

<pre><code>00_ToDo
01_NoLabel
10_仕事
  10_仕事/1001_xxx
  10_仕事/1001_yyy
20_プライベート
...
</code></pre>

<p>みたいに番号を付けてくことで思い通りの順番に並べ替えることが出来ます。</p>

<h3 id="ラベルをフォルダの様に使う">ラベルをフォルダの様に使う</h3>

<p>Gmailを使う前にはThunderbirdを使っていましたが、
大概の(昔の?)メールクライアントではフィルターで振り分けを行うとき
<strong>フォルダ</strong>という概念で行って居る思います。</p>

<p><strong>ラベル</strong>と言った場合、一つのメールに対して複数のラベルを付けることが出来ます。</p>

<p><strong>フォルダ</strong>と言った場合、一つのメールは必ずどこか一つのフォルダに属している状態になります。</p>

<p>Thunderbirdなんかでフォルダ分けをしてIMAPでGmailと同期すると
フォルダがそのままラベルに変換されますが
Gmail側で複数のラベルがついてるものはThunderbird側では各フォルダにコピーが存在している状態になったいます(多分)。</p>

<p>メールクライアントではないですが、
Evernoteなんかだとノートブックが<strong>フォルダ</strong>、タグが<strong>ラベル</strong>にあたります。</p>

<p>最近はこの<strong>ラベル</strong>という感じのものが増えてきた感がありますが、
それはメールなどでも数が多くなってきた(多くのメールを保存できる様になった)ことや
同時にコンピューターの速度が上がって検索の速度が上がってきたことがあると思います。</p>

<p>フォルダに行って見る、ということよりラベルを指定して検索したほうが便利(速い)、と。</p>

<p>そうはいうものの、もともとフォルダ的な分け方をしていたので
Gmailのラベルでも複数のところに同じメールがあるのは気持ちよくないので一つのメールには基本的に一つのラベルが付くようにしていました。</p>

<p>フィルタを大量に作ると、必ず一つのメールに対して複数のフィルタが合致してしまうことが出てきますが、
これは<code>含む</code>へキーワードとして<strong>has:nouserlabels from:rcmdnk@gmail.com…</strong>の様に<strong>has:nouserlabels</strong>を条件に加えてやることで
唯一のラベルを付けることが出来るようになります。</p>

<p><strong>has:nouserlabels</strong>は<strong>ラベルがついてない</strong>という条件なので、
フィルタを順に適用していくとき、最初に適用されたもののラベルが付いて
後のフィルタに関しては適用されないようになります。</p>

<p>ただ、ちょっと面倒なのが、Gmailのフィルタはウェブインターフェース上だと
編集したものが一番下に移動するようになっており、それ以外では順番を変更するすべがありません。</p>

<p>にもかかわらずフィルタは上から順に適用されていきます。</p>

<p>大量のフィルタがある時、上の方のフィルタを編集して一番下に来てしまうと
他のフィルタすべてをちょっと変更して戻して、みたいな事をして移動しないといけませんが
現実的に無理です。</p>

<p>この場合、フィルタのエキスポート/インポート機能を用いて</p>

<ul>
  <li>すべてのフィルタを選択してエキスポート(XMLファイル)</li>
  <li>エキスポートされたXMLファイルを直接編集</li>
  <li>編集したファイルをインポート(ファイルを選択、ファイルを開く、でフィルタがインポートされる、まだ実際には導入されない)</li>
  <li>この時点で古いフィルタをすべて選択肢、削除</li>
  <li>インポートされたフィルタをすべて選択して作成</li>
</ul>

<p>といったことをやります。</p>

<p>フィルタを作成する所でちょっと時間がかかるので(100個で1分位)、
その間にメールが来てしまうと振り分けられないのがちょっと面倒。</p>

<p>それが嫌なら古いメールを削除する前に新しいフィルタを作成し、
古いフィルタだけを選択して削除することが出来ます。
ただ、この場合古いフィルタを一つづつ選択していかないといけないので面倒です。</p>

<p>なので普通は先に削除してから作る様にしています。</p>

<h3 id="nolabelラベル">NoLabelラベル</h3>

<p>すべてのフィルタにかからないメールがあるかと思いますが
通常はその様なメールは重要なものではないはずです。
(人によってはそうではないことのが多いということもあるとは思いますが。)</p>

<p>その場合、その様なメールが受信トレイ(Inbox)に残ると
スマホとかのGmailアプリで通知が来るのであまりうれしくありません。</p>

<p>そこで、すべてのフィルタを適用した最後に
<code>含む</code>の条件で<code>has:nouserlabels</code>だけを入れて、
これに対して<strong>受信トレイをスキップする(アーカイブする)</strong>
を設定した上で
<strong>01_NoLabel</strong>などの適当なラベルを付けます。</p>

<p>これによってフィルタにかからないメールは通知を出さなくなります。</p>

<p>ただ、重要なメールも入ってる可能性もそこそこあるので
チェックしやすいように番号を早くしておいた方が良いかと。</p>

<h3 id="google-apps-scriptで自動削除">Google Apps Scriptで自動削除</h3>

<p>Googleカレンダーの通知などをメールで送る様にしておくと
結構な数が溜まっていきますが、これに関しては残しておく意味は全くありません。</p>

<p>最近ではストレージの容量も増えてきたので古いメールを削除しなくてはいけない、
ということはあまり起こらないと思いますが絶対必要が無いものは定期的に消してしまいたいものです。</p>

<p>そういったメールを適当な<strong>90_Tmp</strong>といった様なラベルを付けておくことで
あとでまとめて消すことが出来ます。</p>

<p>さらに、Gmailに関してはgoogle Apps Scriptから操作が出来るので
これを使って</p>

<ul>
  <li><strong>90_Tmp</strong>ラベルがついていて1週間以上前のメールを削除</li>
</ul>

<p>といった設定が出来ます。</p>

<p>スクリプトの内容や設定方法は以前の記事で。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/476313048X?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=476313048X&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/41KPkoQw70L._SS90_CR0,0,120,90_.jpg" alt="メールの超プロが教えるGmail仕事術" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/04/09/computer-gmail/">Gmailでのラベル設定</a></div></li></ul>

<h2 id="今回変更した部分">今回変更した部分</h2>

<p>今回変更したのは特に
以前の<strong>ラベルをフォルダの様に使う</strong>の部分です。</p>

<p>フィルタの順序がすべてにおいて重要だったりする部分が面倒なのと、
<strong>ラベル</strong>をラベルらしくつかっても良いんじゃないか(一つのメールに複数ラベルを付ける)、
そっちのがやはり便利じゃないか、と思いだしたりしたからです。</p>

<p>フィルタ的な具体的な部分としては
各フィルタの<strong>has:nouserlabels</strong>を外す、ということです。</p>

<p>この様に複数のラベルを付けたい場合、受信トレイをスキップするべきものとそうでないものが
同じメールに付く場合ちょっと面倒です。</p>

<p>以前の場合だとそれぞれのフィルタでスキップするかどうか決めていて、
最初に重要な受信トレイに残す、というフィルタを適用すればそのまま残っていましたが、
この方法だと後から(先でも)スキップするフィルタがかかるとスキップされてしまいます。</p>

<p>これを避けるために、<strong>99_DummyInbox</strong>というダミーなラベルを導入します。</p>

<p>そして残したいメールに対してこのラベルが付くようなフィルタを作ります。</p>

<p>全てについてまとめて付けても良いですし、
XMLファイルを編集して残したい条件のものをコピペしてこのラベルに置き換えたものを追加しても良いです。
その場合ちょっとフィルタの量は増えてしまいますが。</p>

<p>そして一番最後に</p>

<p><strong>-label:99_DummyInbox</strong>を<code>含む</code>(<code>-</code>をつけてるのでつまり<strong>99_DummyInbox</strong>のラベルが<code>付いてない</code>)
メールに対して<strong>受信トレイをスキップする</strong>を適用するフィルタを作ります。</p>

<p>これによって受信トレイに残す必要のないメールを最後に一斉にアーカイブすることが出来ます。</p>

<p>この方法だとフィルタの順番も一番最後の受信トレイスキップ用のフィルタ以外は
気にしなくて良くなります。</p>

<p>なのでWebインターフェース上からアップデートするのもそれほど非現実的ではありません。
(一つ編集したら、最後の<strong>-label:99_DummyInbox</strong>のものをちょっと編集(適当に<code>含む</code>にスペース入れるとか。。。)してもう一度戻すとかして
また一番下に戻す。)</p>

<p>実際には上に書いた<strong>NoLabel</strong>も使っているので
NoLabelのものとDummyInboxのフィルタ2つを最後に持ってくる様な作業を行っています。</p>

<h2 id="まとめ">まとめ</h2>

<p>以前まではラベルを無理やりフォルダの様に使っていましたが、
フィルタの変更方法の制限などで面倒な所がありました。</p>

<p>その辺も考慮してラベルをラベルっぽく使う様にしてみましたが、
フィルタ順をそこまで気にしなくて良くなったのは結構楽です。</p>

<p>加えて複数のラベルが付いてる方が実際に探しやすいです。</p>

<p>フィルタの条件、ラベルの付け方ももうちょっと工夫できそうな感じもしますが、
基本的にはこんな感じで使って行こうと思います。</p>

<p>使い方については決まったものの、やはりフィルタをウェブインターフェースで管理したり、
エキスポートしたXMLを直接編集するのは結構面倒です。</p>

<p>そこでフィルタをYAML形式でわかりやすく管理するためのツールも作ったのでよかったら次の記事も見てみてください。</p>

<p><a href="http://octopress.test/blog/2017/07/06/computer-gmail-python/">http://octopress.test/blog/2017/07/06/computer-gmail-python/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MacのメニューバーでGmailを確認出来るMenuBarGmailのアップデート]]></title>
    <link href="https://rcmdnk.com/blog/2017/07/12/computer-mac-python-gmail/"/>
    <updated>2017-07-12T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2017/07/12/computer-mac-python-gmail</id>
    <content type="html"><![CDATA[<p>MacでGmailを確認する際にメニューバーに未読メールの通知があると便利で、
それを実現するアプリはいくつかありますが、
必要なラベルの選択やフィルター機能と言ったものまで付いてるものが無かったので
自分で作ったのが
<a href="https://github.com/rcmdnk/MenuBarGmail">MenuBarGmail</a>
です。</p>

<p>そのMenuBarGmailをちょっとアップデートしたのでそれについて。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#menubargmail" id="markdown-toc-menubargmail">MenuBarGmail</a></li>
  <li><a href="#今回のアップデート" id="markdown-toc-今回のアップデート">今回のアップデート</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="menubargmail">MenuBarGmail</h2>

<div class="github-widget" data-repo="rcmdnk/MenuBarGmail"></div>

<p>ソースコードはGitHubにあります。</p>

<p>インストールはHomebrewで</p>

<pre><code>$ brew cask install rcmdnk/rcmdnkcask/menubargmail
</code></pre>

<p>とするかGitHubのレポジトリの<strong>releases</strong>から最新のものをダウンロード、解凍して
中にあるMenuBarGmail.appを<strong>/Applications</strong>に入れてください。</p>

<p>クリックして立ち上げると
最初にGmailのアカウントに関する認証をブラウザを立ち上げて行います。</p>

<p>認証を許可すると
下の様な封筒アイコンと、未読数がメニューバーに現れます。</p>

<p><img src="https://rcmdnk.com/images/post/20151117_menubargmaillabels.jpg" alt="20151117_menubargmaillabels.jpg" class="pic" /></p>

<p>デフォルトではInboxの未読数だけを見ますが、
ラベルの設定や、指定したラベルの中でもさらにFilterを設定して
必要なメールだけの未読数を数えて表示することも出来ます。</p>

<p>基本的にはこの未読通知を表示させておいて
後はブラウザでちゃんと確認、という使い方をしていますが、
メールの内容の表示や、メールの既読化、未読メールに対する返信
などと言った機能もあります。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2015/11/17/computer-mac-python/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/MacApp/thumbnail/MenuBarGmail_120_90.png" width="120" height="90" alt="MenuBarGmail_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2015/11/17/computer-mac-python/">rumpsとGmail APIを使ってMacのGmailメニューバーアプリを作ってみた</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2015/11/24/computer-mac-python/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20151124_menubargmailshow_120_90.jpg" width="120" height="90" alt="20151124_menubargmailshow_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2015/11/24/computer-mac-python/">MenuBarGmailに既読機能、メール送信機能を付けた</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2015/12/21/computer-mac-python-gmail/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20151124_menubargmailshow_120_90.jpg" width="120" height="90" alt="20151124_menubargmailshow_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2015/12/21/computer-mac-python-gmail/">MacのMenuBarGmailがメールをアップデートしなくなるバグをフィックス</a></div></li></ul>

<h2 id="今回のアップデート">今回のアップデート</h2>

<p>今回のアップデートはネットワークが切れたりした時に
メールを確認に行って失敗するとそこで止まって応答しなくなってしまう、
と言う酷いバグのフィックスです。</p>

<p>このバグ自体は随分前に直していたんですが、
OSをアップデート後、アプリにコンパイルすると上手く起動出来なくて
アプリの作成が出来てませんでした。</p>

<p>MenuBarGmailはPythonで作っていて、
rumpsというモジュールを使っています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2015/11/16/computer-mac-python/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20151116_rumps_test_120_90.jpg" width="120" height="90" alt="20151116_rumps_test_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2015/11/16/computer-mac-python/">rumpsを使ってPythonで簡単にMacのメニューバーアプリを作る</a></div></li></ul>

<p>さらに作ったスクリプトを
<a href="https://pypi.python.org/pypi/py2app/">py2app</a>
を使ってアプリ化しています。</p>

<p>スクリプトの状態で走らせると上手く起動出来るのですが、
アプリ化して起動すると
<strong>Open Console</strong>/<strong>Terminate</strong>というボタンとともに
<strong>MenuBarGmail Error</strong>というエラーポップアップが出てきます。</p>

<p><strong>Open Console</strong>をしてコンソールで見てみると</p>

<blockquote>
  <p>Detected missing constraints for <private>.  It cannot be placed because there are not enough constraints to fully define the size and origin. Add the missing constraints, or set translatesAutoresizingMaskIntoConstraints=YES and constraints will be generated for you. If this view is laid out manually on macOS 10.12 and later, you may choose to not call [super layout] from your override. Set a breakpoint on DETECTED_MISSING_CONSTRAINTS to debug. This error will only be logged once.</private></p>
</blockquote>

<p>こんな感じのエラーが。</p>

<p>中に<strong>macOS 10.12</strong>ウンタラカンタラとあるので
OSのアップデートにrumpsなりpy2appが対応してないのかな、
と思ってしばらく放っておいたのですが、
今回pipでインストールしてあるモジュールを一通り新しくして
もう一度やってみたらこのエラーがでなくなりました。</p>

<p>ということでとりあえず使えるかな、と思ったら今度はメールが全然取得出来ない状態。
調べてみると最初に作った時に
<a href="https://rcmdnk.com/blog/2015/11/17/computer-mac-python/#sslpy%E3%81%AE%E5%95%8F%E9%A1%8C">sslモジュールで起こった問題</a>
と同じことが他で起こってるようでした。</p>

<p>sslモジュールの中ではhttplib2モジュールの中にある<strong>cacerts.txt</strong>と言うテキストファイルを読んでるのですが、
py2appではモジュール群をzipファイルに纏めた形でアプリの中に収納しています。
この中にあるテキストファイルを読もうとするのでそこでエラーが出ます。</p>

<p>なのでこのテキストファイルを別途アプリの中に収納し、
それを読める様にモジュールをちょっといじって入れる様なことをしていました。</p>

<p>これと同じことがhttplib2の中でも起こっていたので同様に
パスを指定する部分をいじって入れることで上手く動くようになりました。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gmailで最初からラベルを全て展開して表示する設定]]></title>
    <link href="https://rcmdnk.com/blog/2017/05/03/computer-gmail/"/>
    <updated>2017-05-03T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2017/05/03/computer-gmail</id>
    <content type="html"><![CDATA[<p>Gmailではフィルター設定を使ってラベルを自動でつける様にしています。</p>

<p>受信トレイに残すメールも何かしらのラベルが付けられる様になっていて、
普段はラベルの方を指定してメールを読み始める方が多いです。</p>

<p>このラベルなんですが、Chromeとかだと初期状態だと
表示できない分のメールが見えない様になっていて、
<strong>その他のラベル</strong>と言うボタンを一回押して展開する必要があります。</p>

<p>これが結構邪魔くさいので最初から展開して表示する様にします。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#gmailのその他のラベルを最初から展開する" id="markdown-toc-gmailのその他のラベルを最初から展開する">Gmailの<strong>その他のラベル</strong>を最初から展開する</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="gmailのその他のラベルを最初から展開する">Gmailの<strong>その他のラベル</strong>を最初から展開する</h2>

<p>Gmailでは結構多くのラベルを使ってメールの振り分けを行っています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/476313048X?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=476313048X&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/41KPkoQw70L._SS90_CR0,0,120,90_.jpg" alt="メールの超プロが教えるGmail仕事術" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/04/09/computer-gmail/">Gmailでのラベル設定</a></div></li></ul>

<p>受信トレイよりラベルを選んでメールを見ることが多いので
ラベルを常に全部表示させておくほうが便利です。</p>

<p>これがGoogle ChromeとかでGmailを開くと</p>

<p><img src="https://rcmdnk.com/images/post/20170503_gmaillabel.png" alt="gmail label" class="pic" /></p>

<p>こんな感じで、ラベルがたくさんある場合見えない部分が
<strong>その他のラベル</strong>としてまとめられ見えない状態になっています。</p>

<p>これを押すと展開されてスクロールして見れるようになります。</p>

<p>この設定、Firefoxだと常に最初から展開されて居る状態になっています。</p>

<p>設定などは共有してるはずなんですが、何が違うのかな、と思ってみてみると、
Chromeの場合、
歯車ボタンを押して設定項目を見てみようとすると、</p>

<p><img src="https://rcmdnk.com/images/post/20170503_gmailsetting.png" alt="gmail setting" class="pic" /></p>

<p>こんな感じになっていますが、<strong>表示モード</strong>の一番上に<strong>タッチ対応</strong>
と言う項目があります。</p>

<p>実はこれが<strong>その他のラベル</strong>を使う設定で、<strong>標準</strong>や<strong>最小</strong>など他の
モードにすると最初から展開された状態になります。</p>

<p>これ、今まで気になってたもののそれ程気にしてなかったんですが、
実はFirefoxだとこの<strong>タッチ対応</strong>の項目はありません。</p>

<p><img src="https://rcmdnk.com/images/post/20170503_firefoxgmail.png" alt="firefox gmail" class="pic" /></p>

<p>というか、<strong>表示モード</strong>でもなく<strong>表示間隔</strong>になっています。
<strong>タッチ対応</strong>という状態だけがちょっと特殊で後は単に表示間隔が違うだけだから、ということだとは思うのですが。</p>

<p>最近Firfoxがタブを閉じるとフリーズするのとVimperatorも使えなくなる危機があるので
ちょっとChromeも使う様になってきてGmailとか開く機会も増えたので
気づいたところです。</p>

<p>他のブラウザを試してみると、WindowsのEdgeとInternet ExplorerではChromeの様に<strong>タッチ対応</strong>が出ました。</p>

<p>一方、MacのSafariで見てみるとFirefoxの様にありませんでした。</p>

<p>デフォルト設定は<strong>タッチ対応</strong>があるなら<strong>タッチ対応</strong>、
無ければ<strong>標準</strong>になっているようで、
この項目を1回も触ったことが無ければそれぞれの環境のデフォルトになっているはずです。</p>

<p>もし、Firefoxの方で<strong>最小</strong>などを選ぶと
Chromeで開いたときにも<strong>最小</strong>の設定に変わります。</p>

<p>この項目が今までイマイチなんなのか良くわからない、と言うかあまり気にしてませんでしたが、
<strong>標準</strong>と<strong>最小</strong>との変更でも結構見た目が変わるので
<strong>タッチ対応</strong>云々関係ない場合でも一度チェックして設定しておいた方が良いです。</p>

<p><strong>標準</strong>、や<strong>小</strong>はある程度の画面の大きさが無いと間隔をそこまで広げないので
例えば<strong>標準</strong>にしておけば画面が大きければ間隔を大きく、
画面が小さければ<strong>最小</strong>と同じ大きさの小さい間隔に自動で表示してくれます。</p>

<p>ちょっと試してみた所、<strong>最小</strong>にして常に間隔を小さくしておくほうが
沢山表示されてよかったので<strong>最小</strong>にしておくことにしました。</p>

]]></content>
  </entry>
  
</feed>
