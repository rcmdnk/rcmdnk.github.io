<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Mac | rcmdnk's blog]]></title>
  <link href="https://rcmdnk.com/blog/tags/mac/atom.xml" rel="self"/>
  <link href="https://rcmdnk.com/"/>
  <updated>2018-08-23T00:51:36+00:00</updated>
  <id>https://rcmdnk.com/</id>
  <author>
    <name><![CDATA[rcmdnk]]></name>
    <email><![CDATA[rcmdnk@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Macがフリーズする現象を回避する(原因はBetterTouchTool)]]></title>
    <link href="https://rcmdnk.com/blog/2018/07/18/mac/"/>
    <updated>2018-07-18T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/07/18/mac</id>
    <content type="html"><![CDATA[<p>最近Macが突如フリーズして、しばらくするとマウスがものすごく重い感じで動くものの
またすぐにフリーズ、という現象が起きて困っていました。</p>

<p>いろいろアプリとかを止めたりして試してみた所どうもBetterTouchToolが原因のようです。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#現象" id="markdown-toc-現象">現象</a></li>
  <li><a href="#原因" id="markdown-toc-原因">原因</a></li>
  <li><a href="#対処法" id="markdown-toc-対処法">対処法</a></li>
  <li><a href="#今後の対応" id="markdown-toc-今後の対応">今後の対応</a></li>
  <li><a href="#bettertouchtoolについて" id="markdown-toc-bettertouchtoolについて">BetterTouchToolについて</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="現象">現象</h2>

<p>起こった現象としてはMacを使っていると突然キー入力もマウス操作もできなくなる、という現象。</p>

<p>その後暫く待つとマウスとかがかろうじて使えるようになるものの、設定が一番遅く変わっていたりして
ものすごく遅い。設定を直しても動作はそのまま。</p>

<p>さらにはウィンドウを切り替えようとするたびに必ずフリーズするので設定画面にたどり着くだけでも大変。</p>

<p>今回ちょっと思ったのが
感圧タッチトラックパッドだと機能が停止すると物理的に押せるわけではないので
ただの動かない板みたいになってしまって壊れた感が強いのでちょっと焦ります。
電子的な跳ね返しで押してる感を出していますが普段は前のトラックパッドの様に押し込めてる気でいるので
反応が無いと物理的に壊れた様な気がしてしまったので。
(Macを停止してるときにもそうなるんですが、めったに止めないし止めてるときには触らないので。)</p>

<h2 id="原因">原因</h2>

<p>原因はマウスジェスチャーなどを追加するBetterTouchToolでした。</p>

<blockquote>
  <p><a href="https://community.folivora.ai/t/macos-10-13-4-freezing-with-bettertouchtool-usage/1185/51">macOS 10.13.4 Freezing with BetterTouchTool Usage - Bug Reports - BetterTouchTool Community</a></p>
</blockquote>

<p>すでにレポートが上がっていてとりあえずの対処法もあります。</p>

<p>BetterTouchTool自体の変更によってどうこうなった、というよりは
MacのアップデートMacOS 10.13.4のセキュリティーアップデートかなにかに関連して
動作に不具合が出るようになったようです。</p>

<p>ただし、10.13.4は4月頭に出ていて、私の手元の環境でも割とすぐにアップデートしていたはずですが、
現象自体は7月に入る前後で始まった感じです。</p>

<p>上のレポートを見てもなにかのアップデートのタイミングで、とかではなく
突如現象が起こりだしてるようです。何かの設定で変なことになるのか、ログみたいなものが増え過ぎたりするのか。</p>

<h2 id="対処法">対処法</h2>

<p>対処法として、BetterTouchToolを止めればよいのですが
便利ツールでまともな代用品もないためそれだと悲しいので、
とりあえず現在の対処用としては以下の様なコマンドを
ターミナルから打つことが作者の人からあげられています。</p>

<pre><code>$ defaults write com.hegenberg.BetterTouchTool BTTDisableSecureInputLookup YES
</code></pre>

<p>私の環境ではこの設定をして以降、現象は再発しなくなりました。
めでたしめでたし。</p>

<h2 id="今後の対応">今後の対応</h2>

<p>作者の人はなんとなく目星は付けてるようですが、
現在ちょうどハネムーン中(一週間前情報)ということで対応はもうちょっと時間がかかる、とのことです。</p>

<h2 id="bettertouchtoolについて">BetterTouchToolについて</h2>

<p>今回フリーズの原因となってしまいましたが、BetterTouchToolはとても便利なツールなので今後も使い続けます。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2015/10/26/computer-mac/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20151026_bettertouchtool_120_90.jpg" width="120" height="90" alt="20151026_bettertouchtool_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2015/10/26/computer-mac/">MacでBetterTouchToolの設定がいきなりなくなった時の復旧方法</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2016/03/05/computer-mac/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/MacApp/thumbnail/BetterTouchTool_120_90.png" width="120" height="90" alt="BetterTouchTool_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2016/03/05/computer-mac/">BetterTouchToolの有料化にあたり</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2014/05/14/computer-mac-btt/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/MacApp/thumbnail/BetterTouchTool_120_90.png" width="120" height="90" alt="BetterTouchTool_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/05/14/computer-mac-btt/">BetterTouchToolの設定</a></div></li></ul>

<p>特にトラックパッドはこれがないと機能の半分も引き出せてないんじゃないか、というくらいです。</p>

<p>キーボードの設定なども出来るので簡単な設定だけならこれで一通りのカスタマイズも出来ます。</p>

<p>自分の環境ではキーボード操作に関してはKarabiner-Elementsが非常に優秀なのでこちらで設定しています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/08/25/computer-mac-karabiner/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170825_karabinerelements0_120_90.jpg" width="120" height="90" alt="20170825_karabinerelements0_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/08/25/computer-mac-karabiner/">Karabiner-Elementsが大分進化してVi Modeとかまで出来る様になっていた</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170905_vimemu_120_90.jpg" width="120" height="90" alt="20170905_vimemu_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/">Vim以外でVimする: Mac+Karabiner-Elements編</a></div></li></ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Evernoteで*を自動でリストに変換したりする機能を止める]]></title>
    <link href="https://rcmdnk.com/blog/2018/05/17/computer-mac-windows-evernote/"/>
    <updated>2018-05-17T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/05/17/computer-mac-windows-evernote</id>
    <content type="html"><![CDATA[<p>Evernoteでメモを書いているとき、
Markdown形式でメモを書くことが多いのですがその際リスト表示で<code>*</code>とかを先頭に使うと
Evernoteがリッチなリスト表示に勝手に変換してくれます。</p>

<p>Evernoteだけで閉じるならまだしも他にもコピーしたりすることもあるのと、
ちょっと表示もあまりよろしくないのでこれを止める様にしました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#設定変更" id="markdown-toc-設定変更">設定変更</a></li>
  <li><a href="#アプリの設定以外にosやimeの設定もあるので注意" id="markdown-toc-アプリの設定以外にosやimeの設定もあるので注意">アプリの設定以外にOSやIMEの設定もあるので注意</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="設定変更">設定変更</h2>

<p>Macの場合、メニューバーの<strong>Evenote</strong>から<strong>環境設定</strong><i class="fa fa-arrow-right"></i><strong>書式設定</strong>に行き
<strong>リスト、水平線、絵文字をキーボードショートカットで自動作成する。</strong>のチェックを外す。</p>

<p><img src="https://rcmdnk.com/images/post/20180517_evernotemac.jpg" alt="20180517_evernotemac.jpg" class="pic" /></p>

<p>Windowsの場合、<strong>ツール</strong><i class="fa fa-arrow-right"></i><strong>オプション</strong>を開き
<strong>ノート</strong>の項目に行き<strong>テキストの書式を自動設定</strong>の項目のチェックを外す。</p>

<p><img src="https://rcmdnk.com/images/post/20180517_evernotewin.jpg" alt="20180517_evernotewin.jpg" class="pic" /></p>

<p>上の写真だと<strong>テキストの書式を自動設定</strong>以下に<strong>“1, “で番号付きリスト</strong>云々という設定がいくつかありますが、
これらの設定は<strong>テキストの書式を自動設定</strong>のチェックを外すと全て無効になります。</p>

<h2 id="アプリの設定以外にosやimeの設定もあるので注意">アプリの設定以外にOSやIMEの設定もあるので注意</h2>

<p>Evernoteで編集してる際に、上記に加えてハイフンを2つ書くと大きな一つのハイフンになってしまうことがあり、
その項目が見つからないな、と思っていたのですが
それはMacの設定によるものでした。</p>

<p><a href="http://octopress.test/blog/2018/05/16/computer-mac/">http://octopress.test/blog/2018/05/16/computer-mac/</a></p>

<p>英文先頭文字を大文字に変換するとかの項目もデフォルトでオンになっています。
これらの項目はGoogle日本語入力とかを使っていても有効です。</p>

<p>それ以外にもIMEの設定とかで意図せぬ動作を設定している場合もあるので、
何か動作がおかしいな、と思った際には、OSの設定、IMEの設定、アプリの設定と
全てチェックする必要があります。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Macで勝手に英文先頭が大文字になったり二重ハイフンが大きなハイフンになったりするのを止める]]></title>
    <link href="https://rcmdnk.com/blog/2018/05/16/computer-mac/"/>
    <updated>2018-05-16T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/05/16/computer-mac</id>
    <content type="html"><![CDATA[<p>MacでEvernoteなんかで編集しているとき、
英文を書いてると先頭が勝手に大文字になったりハイフンを続けて書くとまとまった一つの大きなハイフンになったりします。</p>

<p>最初、アプリの設定かもしくはGoogle日本語入力によるものかと思っていましたが
Mac自体の機能によるものでした。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#ユーザ辞書設定" id="markdown-toc-ユーザ辞書設定">ユーザ辞書設定</a></li>
  <li><a href="#特定のアプリのみで効く" id="markdown-toc-特定のアプリのみで効く">特定のアプリのみで効く</a></li>
  <li><a href="#特定の入力ソースでのみ効く" id="markdown-toc-特定の入力ソースでのみ効く">特定の入力ソースでのみ効く</a></li>
  <li><a href="#今後も余計なお世話が増えるかも" id="markdown-toc-今後も余計なお世話が増えるかも">今後も余計なお世話が増えるかも</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="ユーザ辞書設定">ユーザ辞書設定</h2>

<p>Macの環境設定から<strong>キーボード</strong>に行き、<strong>ユーザ辞書</strong>のタブを開くと
以下のような設定項目があります。</p>

<p><img src="https://rcmdnk.com/images/post/20180516_macdic.jpg" alt="20180516_macdic.jpg" class="pic" /></p>

<p>左の方にはユーザが設定した変換辞書があります。
(見てみると随分昔にiPhoneで設定した辞書が残っていて忘れてたものたちが。。。)</p>

<p>重要なのは右側で、ここに自動変換に関わる項目が並んでいます。</p>

<ul>
  <li>英字入力中にスペルを自動変換</li>
  <li>文頭を自動的に大文字にする</li>
  <li>スペースバーを2回押してピリオドを入力</li>
  <li>Touch Barに入力候補を表示</li>
  <li>スペルチェック</li>
  <li>スマート引用符とスマートダッシュを使用</li>
</ul>

<p>スマート引用符、というのは
下みたいな感じで通常のクォートではなく
違った記号に変換する機能です。</p>

<p><img src="https://rcmdnk.com/images/post/20180516_macsmartquote.jpg" alt="smartquote" class="pic" /></p>

<p>スマートダッシュというのがハイフンを2つ並べた際に大きな一つのハイフンにする機能です。</p>

<p>題になっている文頭の大文字化は二つ目、ハイフンの自動変換は最後のものと関連があります。</p>

<p>結論から言うとスペルチェックの項目以外、全て必要ないので全てはずしました。</p>

<p>特に気になっていたのがEvernoteとかにコードとかコマンドのメモを書き込んでいるとき、</p>

<pre><code>$ bash --version
</code></pre>

<p>とか書こうとすると<code>--</code>が<code>ー</code>になってしまって後からコピペ実行出来なくなってしまうこととか
コマンドやコードを書いてる際にも全て先頭を大文字にしてくれるので一度変換された後に書き直したり。</p>

<p>それほど頻度が高くなかったので今まで我慢してましたが今更ながら変更しました。</p>

<p>スマートダッシュなどは古くからある設定の様ですが、
スペースバーを2回とかはSierraくらいから導入されたものの様です。</p>

<h2 id="特定のアプリのみで効く">特定のアプリのみで効く</h2>

<p>ここにある設定ですが、ターミナルで作業している時に変換される様な事はありません。
(文頭の大文字変換なども全て無効。)</p>

<p>Evernoteやメモ.appなどのリッチな表現が入力出来るアプリの上だと有効になります。</p>

<p>なので普段書いている際には余り気にならなかったのと、
アプリのせいだと思って敢えて調べたりしてませんでした。</p>

<h2 id="特定の入力ソースでのみ効く">特定の入力ソースでのみ効く</h2>

<p>さらにはものによっては特定の入力ソースでのみ効きます。
今はGoogle日本語入力を使っていますが、その英字入力の際には
上記の</p>

<ul>
  <li>英字入力中にスペルを自動変換</li>
  <li>スペースバーを2回押してピリオドを入力</li>
</ul>

<p>は効かない様です。無駄に先頭の大文字やスマートダッシュは効くのですが。</p>

<p>スペースバーを2回、というのはおそらく有効であれば入力することもあるので気づいてさらにストレスを感じてたと思います。</p>

<p>これらの項目は元から入っている英語の<strong>ABC</strong>や<strong>U.S.</strong>、または<strong>日本語</strong>にある<strong>日本語</strong>(旧ことえり)の中にある英数を選ぶと
使うことが出来ます。
また、ユーザ辞書の変換もGoogle日本語入力では候補に出ず、<strong>日本語</strong>を使う場合にのみ出てきます。</p>

<p><strong>日本語</strong>に関してはEl Capitanからライブ変換とか入ってますが使いづらいので
どこでも使えるGoogle日本語入力にしています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2014/05/15/computer-mac-ime/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/MacApp/thumbnail/GoogleIME_120_90.png" width="120" height="90" alt="GoogleIME_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/05/15/computer-mac-ime/">MacでのIMEの設定</a></div></li></ul>

<p>ちなみにGoogle日本語入力だけ残そうとすると最後に<strong>US</strong>とかが消せなかったりしますが
一度<strong>日本語</strong>を加えて<strong>US</strong>を削除するとその後<strong>日本語</strong>も消せるので
Googleの<strong>英数</strong>、<strong>ひらがな</strong>だけ残すことが出来ます。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2014/05/23/computer-mac/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20140523_mac_ime_1_120_90.jpg" width="120" height="90" alt="20140523_mac_ime_1_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/05/23/computer-mac/">Macで入力ソースにいつの間にかU.S.が入ってきて消せない時の対処法</a></div></li></ul>

<h2 id="今後も余計なお世話が増えるかも">今後も余計なお世話が増えるかも</h2>

<p>スペースバーの設定はGoogle日本語入力では効かないものの、
導入されたのは２年弱前の比較的最近なSierraの時点です。</p>

<p>したがって今後も何らかの機能がここに導入される可能性があり、
またデフォルトではオンになっている可能性が高いです。</p>

<p>今後OSをアップデートする際にはユーザ辞書にある項目を見て
必要ない機能はオフにする、というチェックが必要です。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macOS High Sierra 10.13.4にしたらDockのフォルダがちょっとおかしくなった]]></title>
    <link href="https://rcmdnk.com/blog/2018/05/08/computer-mac/"/>
    <updated>2018-05-08T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/05/08/computer-mac</id>
    <content type="html"><![CDATA[<p>先日macOS High Sierra 10.13.4がリリースされて
手持ちのMacでアップデートを行ったんですがDockに設置してある
フォルダの様子がちょっとおかしくなってました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#macos-high-sierra-10134" id="markdown-toc-macos-high-sierra-10134">macOS High Sierra 10.13.4</a></li>
  <li><a href="#dockのフォルダがおかしい" id="markdown-toc-dockのフォルダがおかしい">Dockのフォルダがおかしい</a></li>
  <li><a href="#修正" id="markdown-toc-修正">修正</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="macos-high-sierra-10134">macOS High Sierra 10.13.4</h2>

<p>10.13.4は外部グラフィックスプロセッサー(eGPU)の対応が導入された
以外はバグフィックスなどがある程度なので
通常の使い勝手に影響が出るようなものはほとんどないと思います。</p>

<h2 id="dockのフォルダがおかしい">Dockのフォルダがおかしい</h2>

<p>アップデートをインストールして再起動したところ、
Dockに設置してあるフォルダがこんな感じになっていました。</p>

<p><img src="https://rcmdnk.com/images/post/20180508_dock0.jpg" alt="dock0" class="pic" /></p>

<p>左から、HOME、アプリケーション、ダウンロード、ゴミ箱、のフォルダです。
表示形式は全て<strong>フォルダ</strong>になってるのでダウンロードなどもそのフォルダの
表示になるはずですがハテナマークになってます。
なぜかアプリケーションフォルダは無事。</p>

<p>さらに、これらにアイコンを合わせるとちゃんと<strong>ダウンロード</strong>とか表示されるのですが
クリックすると内容表示をせずにいきなりFinderを開く様になっています。
(設定は<strong>グリッド</strong>表示設定。)</p>

<h2 id="修正">修正</h2>

<p>表示に関しては右クリックメニューから表示形式を一度<strong>スタック</strong>に変えるとちゃんとスタック表示になり、
さらに<strong>フォルダ</strong>に変えるとちゃんとフォルダ表示になりました。</p>

<p>ただクリックでいきなりFinderを開く動作は変わらず。</p>

<p>仕方ないので一度Dockから削除してもう一度これらのフォルダを設置すると</p>

<p><img src="https://rcmdnk.com/images/post/20180508_dock1.jpg" alt="dock1" class="pic" /></p>

<p>Dockに登録されてる情報が何かおかしくなったみたいなのですが
アプリケーションフォルダだけ無事だったのが逆に謎。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[macOS High Sierraでコマンドラインメールを使う]]></title>
    <link href="https://rcmdnk.com/blog/2018/05/03/computer-mac/"/>
    <updated>2018-05-03T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/05/03/computer-mac</id>
    <content type="html"><![CDATA[<div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/4873111951?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=4873111951&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/51atPcYiFML._SS200_.jpg" alt="Postfix実用ガイド" /></a>
</div>

<p>新しいMacでコマンドラインメールも使えてる風感じを受けていたら
やはり使えなくて設定しましたが、
以前と大分違う感じになっていてちょっと戸惑いました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#新規high-sierraと以前のアップグレード版は違う" id="markdown-toc-新規high-sierraと以前のアップグレード版は違う">新規High Sierraと以前のアップグレード版は違う?</a></li>
  <li><a href="#launchdaemons" id="markdown-toc-launchdaemons">LaunchDaemons</a></li>
  <li><a href="#ログがない" id="markdown-toc-ログがない">ログがない</a></li>
  <li><a href="#gmailのsmtpサーバーを使う" id="markdown-toc-gmailのsmtpサーバーを使う">GmailのSMTPサーバーを使う</a></li>
  <li><a href="#以前の設定との違い" id="markdown-toc-以前の設定との違い">以前の設定との違い</a></li>
  <li><a href="#上手く行かない場合のチェック" id="markdown-toc-上手く行かない場合のチェック">上手く行かない場合のチェック</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="新規high-sierraと以前のアップグレード版は違う">新規High Sierraと以前のアップグレード版は違う?</h2>

<p>以前使っていたMacもHigh Sierraでしたがその前のバージョン
(最初はMavericks)
からのアップグレードで使っていました。</p>

<p>なので設定ファイルや中のソフトとかが一部新規High Sierraとは違う可能性があります。</p>

<p>ちょっとその辺も含めて今回やった設定などについてメモしておきます。</p>

<h2 id="launchdaemons">LaunchDaemons</h2>

<p><code>postfix</code>を使ったメールサーバーを作りますが、
以前はLaunchDaemonsを使った自動機能が行われていましたが、
今回確認して見たところ</p>

<p><strong>/System/Library/LaunchDaemons/org.postfix.master.plist</strong>
がありませんでした。
実際、</p>

<pre><code>$ sudo postfix status
postfix/postfix-script: the Postfix mail system is not running
</code></pre>

<p>と走っていません。</p>

<p>なので手動(<code>sudo postfix start</code>)で立ち上げたりしてテストをしていましたが、
実は止まっている状態で</p>

<pre><code>$ echo test mail from Mac! | mail -s test example@gmail.com
</code></pre>

<p>みたいにメールを送ってみると設定がちゃんとされていれば送れます。</p>

<p>直後にもう一回<code>postfix</code>を調べてみると</p>

<pre><code>$ sudo postfix status
postfix/postfix-script: the Postfix mail system is running: PID: 29420
</code></pre>

<p>とpostfixが走っています。</p>

<p>ただ、しばらく(1分位?)すると再び<strong>not running</strong>になります。</p>

<p>どうも<code>mail</code>コマンドでメールを送る際、<code>postfix</code>のサービスが必要であれば自動で立ち上げ
さらにしばらくすると止めるという仕様になってるらしいです。</p>

<p>下みたいなLaunch Daemon Property Listを自分で用意して入れてる人も居るみたいですが
その必要はないみたい。</p>

<blockquote>
  <p><a href="https://gist.github.com/ryanjbonnell/836715fd3e6be8cc81e786ee498e34a4">macOS 10.12 “Sierra” Postfix Launch Daemon Property List</a></p>
</blockquote>

<p>また、<code>postfix</code>の設定を変更した際もすぐに反映したければ</p>

<pre><code>$ sudo postfix reload
</code></pre>

<p>しても良いですが、直前に<code>mail</code>コマンドを使ってない限り、それを行う必要もなく、
次に<code>mail</code>をする際に自動的に<code>postfix</code>が新しい設定を読み込んで立ち上がってくれます。</p>

<p>このあたり、前のMacではHigh Sierraになってからチェックしてませんでしたが
実はこれと同じ状態だったのかもしれません。
(もしくはLaunchDaemonsが残ってて常に<code>postfix</code>が走っていたけど実はそれは余計でわざわざLaunchDaemonsを使わなくても良かった状態だったか。)</p>

<h2 id="ログがない">ログがない</h2>

<p>以前までは<strong>/var/log/maillog</strong>に<code>postfix</code>のログが出ていました。</p>

<p>ですが、今の環境で<code>postfix</code>を走らせてもログが出ません。</p>

<pre><code>$ sudo postfix start
</code></pre>

<p>として動かしても出ません。</p>

<p>このログを見るためには</p>

<pre><code>$ log stream --predicate  '(process == "smtpd") || (process == "smtp")' --info
</code></pre>

<p>とします<sup id="fninref:1"><a href="#fnin:1" rel="footnote">1</a></sup>。</p>

<p>これでこのターミナルにログが出てくるので他のターミナルでメールとかを送るテストを行って確認を行います。</p>

<p>もし常時監視したいのであればこのコマンドをどこかのファイルに書き出す様にして自動で立ち上げておいたりする必要があります。
どこかの設定でできそうなものですが。</p>

<p>この出力が<strong>コンソール.app</strong>とかに出てくるものと関係あると思ってたんですが
どうもそれとは違うようで<strong>コンソール.app</strong>から<code>smtp</code>のログは確認出来ませんでした。
(この辺システムがよくわかってない。)</p>

<h2 id="gmailのsmtpサーバーを使う">GmailのSMTPサーバーを使う</h2>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/4839918937?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=4839918937&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/51XTHPZVJFL._SS90_CR0,0,120,90_.jpg" alt="メーラーだえもんさんへの手紙" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/11/14/computer-mac/">MacでGmailのSMTPサーバーを使ってコマンドラインからメールを送れるようにする</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/B00JVS7CZ8?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=B00JVS7CZ8&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/81sRfcGss5L._SS90_CR0,0,120,90_.jpg" alt="Trick to Daily Mail Online" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/10/26/compputer-mac/">Mac Yosemiteでのコマンドラインメール設定</a></div></li></ul>

<p>ということで自動起動やログの部分を理解した上で
GmailのSMTPサーバーを使ってMacからメールを送る設定をします。</p>

<p>設定自体は上でやったようなことと一緒で、
まずパスワードのファイルを作ります。</p>

<p>2段階認証にしてる場合には
<a href="https://security.google.com/settings/security/apppasswords">アプリパスワード</a>
から専用のパスワードを取得します。</p>

<pre><code>$ cd /etc/postfix
</code></pre>

<p>へ移動して</p>

<pre><code>$ sudo vim gmail_passwd
</code></pre>

<p>などで編集して</p>

<figure class="code"><figcaption><span>/etc/postfix/gmail_passwd </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span></span>smtp.gmail.com:587 &lt;user&gt;@gmail.com:&lt;passwd&gt;
</span></code></pre></td></tr></table></div></figure>

<p>といった内容のファイルを用意します。</p>

<p>出来たら</p>

<pre><code>$ sudo postmap gmail_passwd
</code></pre>

<p>で、<strong>gmail_passwd.db</strong>を作ります。平文でパスワードを書いた<strong>gmail_passwd</strong>は削除しておきます。</p>

<pre><code>$ sudo rm gmail_passwd
</code></pre>

<p>出来たら
以下を<strong>/etc/postfix/main.cf</strong>に加えます。</p>

<figure class="code"><figcaption><span>/etc/postfix/main.cf </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span></span><span class="nv">relayhost</span> <span class="o">=</span> smtp.gmail.com:587
</span><span class="line"><span class="nv">smtp_sasl_auth_enable</span> <span class="o">=</span> yes
</span><span class="line"><span class="nv">smtp_sasl_password_maps</span> <span class="o">=</span> hash:/etc/postfix/gmail_passwd
</span><span class="line"><span class="nv">smtp_sasl_security_options</span> <span class="o">=</span> noanonymous
</span><span class="line"><span class="nv">smtp_use_tls</span> <span class="o">=</span> yes
</span><span class="line"><span class="nv">smtp_tls_security_level</span> <span class="o">=</span> encrypt
</span><span class="line"><span class="nv">smtp_sasl_mechanism_filter</span> <span class="o">=</span> plain
</span></code></pre></td></tr></table></div></figure>

<p>これで上のログを表示させながら別ターミナルから</p>

<pre><code>$ echo test mail from Mac! | mail -s test &lt;your address&gt;
</code></pre>

<p>といった感じに適当にメールを送ってみます。
上手くメールが届いてたらOK。</p>

<p>この設定だと、<strong>From</strong>欄はGmailで<strong>デフォルト</strong>に指定しているアドレスになっているはずです。</p>

<h2 id="以前の設定との違い">以前の設定との違い</h2>

<p>大体以前の設定と同じですが、今回
<code>relayhost</code>の部分が括弧つき:</p>

<pre><code>relayhost = [smtp.gmail.com]:587
</code></pre>

<p>の状態だと</p>

<pre><code>2018-05-03 XX:XX:XX.XXXXXX+0900 0x969feed  Info        0x0                  70961  smtp: 942124EFDB4: to=&lt;rcmdnk@gmail.com&gt;, relay=smtp.gmail.com[108.177.97.108]:587, delay=1, delays=0.04/0.06/0.78/0.16, dsn=5.5.1, status=bounced (host smtp.gmail.com[108.177.97.108] said: 530-5.5.1 Authentication Required. Learn more at 530 5.5.1  https://support.google.com/mail/?p=WantAuthError b5sm20286954pfc.16 - gsmtp (in reply to MAIL FROM command))
</code></pre>

<p>といったエラーが出ました。
特にあってもなくても良いはずで、いろいろな例でも付けた状態のものが多いですが
何故かエラーに。
これを外すと問題なく送れるようになりました。</p>

<h2 id="上手く行かない場合のチェック">上手く行かない場合のチェック</h2>

<p>上手く行かない場合には</p>

<pre><code>$ log stream --predicate  '(process == "smtpd") || (process == "smtp")' --info
</code></pre>

<p>でログを表示させつつ、<code>mail</code>を送るチェックの他に</p>

<pre><code>$ sudo postfix start
</code></pre>

<p>もしくは</p>

<pre><code>$ sudo postfix reload
</code></pre>

<p>など、手動で<code>postfix</code>をスタートさせたりリロードさせたりすると
<code>main.cf</code>のエラーとかを表示してくれることがあります。
(<code>main.cf</code>の間違いならコマンドを打った側に出ます。)</p>
]]></content>
  </entry>
  
</feed>
