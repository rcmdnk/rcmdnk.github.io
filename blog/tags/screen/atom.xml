<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: screen | rcmdnk's blog]]></title>
  <link href="https://rcmdnk.com/blog/tags/screen/atom.xml" rel="self"/>
  <link href="https://rcmdnk.com/"/>
  <updated>2020-08-13T00:24:10+00:00</updated>
  <id>https://rcmdnk.com/</id>
  <author>
    <name><![CDATA[rcmdnk]]></name>
    <email><![CDATA[rcmdnk@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[GNU Screen 4.8.0リリース]]></title>
    <link href="https://rcmdnk.com/blog/2020/02/07/computer-screen/"/>
    <updated>2020-02-07T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2020/02/07/computer-screen</id>
    <content type="html"><![CDATA[<p>ターミナルマルチプレクサであるGNU Screenの安定版がアップデートされ、4.8.0がリリースされました。</p>

<!-- MORE -->

<ul id="markdown-toc">
  <li><a href="#gnu-screen-480" id="markdown-toc-gnu-screen-480">GNU Screen 4.8.0</a></li>
  <li><a href="#アップデート内容" id="markdown-toc-アップデート内容">アップデート内容</a></li>
  <li><a href="#screenutf8" id="markdown-toc-screenutf8">screenutf8</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>
  <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3802317723662375" data-ad-slot="5762198341"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="gnu-screen-480">GNU Screen 4.8.0</h2>

<blockquote>
  <p><a href="https://savannah.gnu.org/forum/forum.php?forum_id=9665">GNU Screen - News: GNU Screen v.4.8.0 [Savannah]</a></p>
</blockquote>

<blockquote>
  <p><a href="https://git.savannah.gnu.org/cgit/screen.git/log/?h=v.4.8.0">screen.git - screen</a></p>
</blockquote>

<p>4.6.0から4.7.0は2年以上空いていのリリースでしたが、
4.8.0は前回2019年10月1日に4.7.0がリリースされてから
4ヶ月ほどでのリリースで、その前のリリース間隔に比べても非常に早いリリースです。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/5512811339?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=5512811339&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/4152ZaEO1SL._SS90_CR0,0,120,90_.jpg" alt="Gnu Screen" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2019/10/31/computer-screen/">GNU Screen 4.7.0リリース</a></div></li></ul>

<p>ということで、何かしら問題とかがあってのリリースかな、という感じです。</p>

<h2 id="アップデート内容">アップデート内容</h2>

<ul>
  <li>Improves startup time by only polling for already open files to close</li>
  <li>Fixes:
    <ul>
      <li>Fix for segfault if termcap doesn’t have Km entry</li>
      <li>Make screen exit code be 0 when checking –version</li>
      <li>Fix potential memory corruption when using OSC 49</li>
    </ul>
  </li>
</ul>

<p>ということですが、今回はパフォーマンス向上、バグフィックス的なもので、
特に最後のものはメモリ操作でクラッシュする恐れがあるもので
少なくともv4.2.0からはあったもの、だそうです。</p>

<blockquote>
  <p><a href="https://git.savannah.gnu.org/cgit/screen.git/commit/?h=v.4.8.0&amp;id=68386dfb1fa33471372a8cd2e74686758a2f527b">Fix out of bounds access when setting w_xtermosc after OSC 49</a></p>
</blockquote>

<pre><code>echo -e "\e]49\e;                                    \n\ec"
</code></pre>

<p>とかするとクラッシュしちゃうよ、ということですが、
4.7.0でやってもすぐにはクラッシュしませんでした。(たまたま書き込むメモリが問題なかっただけ、かもしれないし、もしかすると変な影響が出てるかもしれないので試すのはおすすめしませんが。)</p>

<p>OSC(Operating system command) 49というのが何なのか、ということで
調べてみたのですが特に設定されてない?</p>

<blockquote>
  <p><a href="http://nanno.dip.jp/softlib/man/rlogin/ctrlcode.html#OSC">エスケープシーケンス一覧</a></p>
</blockquote>

<p>上のリリースノートにも書いてありますが、実際この様なものが送られる可能性があるかどうかは
分からないですがバグはバグなので直した方が良いもの、ということで。</p>

<p>それ以外でも単純なスタート時のパフォーマンス向上もあるのでアップデートしておいた方が良いです。</p>

<h2 id="screenutf8">screenutf8</h2>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2013/03/22/screen-install/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20130322_screen_char_non_120_90.jpg" width="120" height="90" alt="20130322_screen_char_non_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/03/22/screen-install/">Macでの文字化け対策用のGNU screenのインストール</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2019/11/19/computer-mac-screen/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20191119_macutf3_120_90.jpg" width="120" height="90" alt="20191119_macutf3_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2019/11/19/computer-mac-screen/">Macで濁点とかが起こす文字化け問題について</a></div></li></ul>

<blockquote>
  <p><a href="https://github.com/rcmdnk/homebrew-rcmdnkpac">rcmdnk/homebrew-rcmdnkpac: Repository for Homebrew Tap, including Formulae of rcmdnk’s packages.</a></p>
</blockquote>

<p>日本語を使う場合に文字化け対策が必要ですが、それをHomebrewでインストールするためのFormulaもアップデートしました。</p>

<pre><code>$ brew install rcmdnk/rcmdnkpac/screenutf8
</code></pre>

<p>で入れられます。Linuxでも入れられます。</p>

<p>本家のFormula(screen)も6日に早速アップデートされていたようです。</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Macで濁点とかが起こす文字化け問題について]]></title>
    <link href="https://rcmdnk.com/blog/2019/11/19/computer-mac-screen/"/>
    <updated>2019-11-19T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2019/11/19/computer-mac-screen</id>
    <content type="html"><![CDATA[<p>Macの中でGNU screenなどを立ち上げると文字化けすることがありますが、
その辺の問題についてのメモ。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#macでの文字化け問題" id="markdown-toc-macでの文字化け問題">Macでの文字化け問題</a></li>
  <li><a href="#問題の確認" id="markdown-toc-問題の確認">問題の確認</a></li>
  <li><a href="#windowsでの文字化け問題" id="markdown-toc-windowsでの文字化け問題">Windowsでの文字化け問題</a></li>
  <li><a href="#homebrewでインストールするgnu-screenの文字化け対策" id="markdown-toc-homebrewでインストールするgnu-screenの文字化け対策">HomebrewでインストールするGNU screenの文字化け対策</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>
  <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3802317723662375" data-ad-slot="5762198341"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="macでの文字化け問題">Macでの文字化け問題</h2>

<p>Macの中でGNU screenを立ち上げたらファイル名の表示などが文字化けしたりすることがあります。</p>

<p>殆どの場合は日本語ファイル名で濁点を使ってる場合で、文字コードの問題です。</p>

<p>ただ、単純にUTF-8かShift_JISか、とかそういったものではなく、濁点や半濁点の扱いの特殊さによります。</p>

<p>MacではFinderでもターミナル上でも基本的にUTF-8で文字を扱いますが、
UTF-8の中でもいくつか文字の取り扱いに対して違うものが存在します。</p>

<p>FinderではNFD(Normalization Form Canonical Decompression)と呼ばれる方式(の改変版)を使っていて、
この中では濁点や半濁点が文字本体とは別に保存され、それぞれで二文字として扱われます。
これはUTF-8-MACと呼ばれることもあります。</p>

<p>一方、ターミナルなどでは濁点や半濁点がある文字は全体で一文字として扱います。</p>

<blockquote>
  <p><a href="https://news.mynavi.jp/article/osxhack-169/">Terminal上で「ダ」や「パ」が付くファイルを検索できない理由と対策 - 新・OS X ハッキング!(169)  マイナビニュース</a></p>
</blockquote>

<p>これにより、Finderで濁点付きのファイルを作って保存した後、
ターミナルで<code>ls</code>とかで見ると文字化けが起こる場合があります。</p>

<p>ただ、Macのターミナルとかはそれ自体がこの問題に対応していて、
普通に<code>ls</code>とかしてもちゃんと化けずに見れます。</p>

<p>一方、この問題に対応していないツールとかだと化けて見えてしまいます。</p>

<p>素のGNU screenとかは対応していないので、そのまま使うとこれらのファイルは文字化けします。</p>

<p><img src="https://rcmdnk.com/images/post/20191119_macutf1.jpg" alt="20191119_macutf1.jpg" class="pic" /></p>

<p>ただし、Macにもともと入っている<code>/usr/bin/screen</code>はこの問題に対応しているのでこれを立ち上げてみても文字化けはしません。</p>

<p>この問題でややこしいのは、文字化けするような<code>screen</code>を立ち上げてる状態で</p>

<pre><code>$ touch aのコピー.txt
</code></pre>

<p>とかいうファイルを作ってみても文字化けはしません。</p>

<p>一方で同じ名前のファイルをFinderで作ってから見ると化けます。</p>

<p>逆にターミナルで作ったものとFinderで作ったものはFinder側からは見分けはつきません。</p>

<p>MacのファイルシステムではNFDのものもそうでないものも同じものとして扱うので
<code>touch</code>で新たに作ろうとしても作れません。(Finderからも勿論同じ名前はつくれません。)</p>

<p>ですが、例えば<code>find</code>コマンドで見つけたりするような場合には区別されるので
NDFなものを探すのは非常に面倒です。</p>

<p>上のリンクにあるように</p>

<pre><code>$ find . -name `echo "オランダ.png" | iconv -f UTF8 -t UTF8-MAC`
</code></pre>

<p>みたいな感じで変換をかましたりしないといけません。</p>

<p>その他の例:</p>

<blockquote>
  <p><a href="https://www.slideshare.net/reflectresults/macos-86746675">macOS 濁点問題にシェル芸で挑んだ話</a></p>
</blockquote>

<h2 id="問題の確認">問題の確認</h2>

<p>実際どういった感じで見れるか、もうちょっと試してみます。</p>

<p>ターミナルで</p>

<pre><code>$ touch aのコピー.txt
</code></pre>

<p>として作ったものと、Finderで適当なファイルの名前を<code>aのコピー.txt</code>
という名前に変更したもの(上記とは別のディレクトリで)を
それぞれ、</p>

<pre><code>$ cd /path/to/touch_file/dir
$ ls &gt; a.txt
$ cd /path/to/finder_file/dir
$ ls &gt; b.txt
</code></pre>

<p>みたいにしてファイルに保存しておきます。
これらのファイルを両方持ってきて<code>nkf</code>コマンドで文字コードを見てみます。
(<code>brew install nkf</code>でインストール。)</p>

<p><img src="https://rcmdnk.com/images/post/20191119_macutf2.jpg" alt="20191119_macutf2.jpg" class="pic" /></p>

<p>こんな感じで、ファイルの文字コードをguessしてみると、
ターミナルから作ったファイルはUTF-8なのに対してFinderで作ったファイル名は
Shift_JISとなっています。</p>

<p>これは実際Shift_JISになってるわけではなく、UTF-8ではないなにか、みたいな感じになって
Shift_JISにしています(だとおもう)。</p>

<p>いずれにしろ、Finderで(半)濁点付きファイルを作ってしまうと
ターミナルからは非常に扱いにくくなります。</p>

<p>基本的にアルファベット、数字だけでファイルを作っていれば良いのですが、
Macを日本語で使ってれば日本語ファイル名も出てきますし、
さらに同じファイル名で保存しようとすると<code>...のコピー</code>という半濁音つきの名前に
なるので結構存在してたりします。</p>

<p>じゃあどうすればよいか、というのは上にあるような変換を行ったり
そういうのを定常的に実行できるようにシェル芸したり。。。</p>

<p>ただ、とりあえずこういったことを覚えておけば対処も出来るかな、ということで。</p>

<h2 id="windowsでの文字化け問題">Windowsでの文字化け問題</h2>

<p>Macで保存したファイルをWindowsで開くと文字化けしたりしますが、
WindowsでShift_JISを使ってたりすることによったりするので
その辺は今回は省略、以下参照。</p>

<blockquote>
  <p><a href="https://sekika.github.io/2016/03/25/MacZip/">Mac で zip 圧縮するときの文字化け対処法</a></p>
</blockquote>

<blockquote>
  <p><a href="https://tmtms.hatenablog.com/entry/2017/04/05/zip">ZIP中のファイル名の文字化け - @tmtms のメモ</a></p>
</blockquote>

<blockquote>
  <table>
    <tbody>
      <tr>
        <td>[日本語名のファイルを直接アップロード・ダウンロードさせる時の諸問題</td>
        <td>ミヤビッチの穴](https://hole.sugutsukaeru.jp/archives/723)</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<h2 id="homebrewでインストールするgnu-screenの文字化け対策">HomebrewでインストールするGNU screenの文字化け対策</h2>

<p>MacにインストールされているGNU screenはちゃんと対策がされているのですが、
古いのと256色が使えなかったりするので
ちゃんと使いたい人はHomebrewとかでインストールしていると思います。</p>

<p>ただ、そのままだと上の文字化け問題が起こります。</p>

<p>なのでこれの対策版用のFormulaを作って使っていました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2013/03/22/screen-install/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20130322_screen_char_non_120_90.jpg" width="120" height="90" alt="20130322_screen_char_non_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/03/22/screen-install/">Macでの文字化け対策用のGNU screenのインストール</a></div></li></ul>

<p>で、この前4.7.0が出たとき、パッチをそのまま当てたらエラーになったので、
ちょっと面倒だったのとパット見問題なさそうだったのでこのFormulaをアップデートせずに
Homebrew-coreにあるデフォルトのものを使ってました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/5512811339?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=5512811339&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/4152ZaEO1SL._SS90_CR0,0,120,90_.jpg" alt="Gnu Screen" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2019/10/31/computer-screen/">GNU Screen 4.7.0リリース</a></div></li></ul>

<p>が、やっぱりだめだったのでアップデートして対策版をインストールすることにしました。</p>

<blockquote>
  <p><a href="https://github.com/rcmdnk/homebrew-rcmdnkpac/blob/master/screenutf8.rb">homebrew-rcmdnkpac/screenutf8.rb at master · rcmdnk/homebrew-rcmdnkpac</a></p>
</blockquote>

<p>パッチの内容に関して、正直なところ内容をきちんと把握してなくて、
4.7.0でも動作するように変更しただけなのでもしかしたら問題が起こるかもしれませんが、
今の所問題なく動いていて、
上記の文字化け問題もクリアできています。</p>

<pre><code>$ brew rm screen # if you have already installed screen
$ brew install rcmdnk/rcmdnkpac/screenutf8
</code></pre>

<p>という感じでインストール出来ます。</p>

<div class="postscript">
  <p><strong>追記: 2019/11/20 </strong></p>

  <p>はてなブックマークで</p>

  <blockquote>
    <p>knok screenのupstreamは今アクティブなのでパッチをちゃんと投げてあげてほしい</p>
  </blockquote>

  <p>というコメントがあったのですが、
このパッチは実は以前(2014年頃)に一度取り入れられてまたはずされる、
といったことがありました。</p>

  <ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/5512811339?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=5512811339&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/4152ZaEO1SL._SS90_CR0,0,120,90_.jpg" alt="Gnu Screen" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/05/04/computer-screen/">GNU screen 最新版について</a></div></li></ul>

  <p>何故戻したのか経緯はわからないのですが、とりあえず
もう一度入れたい場合は戻した経緯を確認してきちんと問題把握した上でやらないとまた弾かれてしまうと思います。</p>

  <p>正直中身を全部ちゃんとは理解してない、という点があってすぐにパッチを送ることも出来ない、というのが悪いんですが、
せっかくなのでちゃんと理解してやりたいですね、いつかは。。。</p>

  <p><strong>追記ここまで</strong></p>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GNU Screen 4.7.0リリース]]></title>
    <link href="https://rcmdnk.com/blog/2019/10/31/computer-screen/"/>
    <updated>2019-10-31T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2019/10/31/computer-screen</id>
    <content type="html"><![CDATA[<div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/5512811339?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=5512811339&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/4152ZaEO1SL._SS200_.jpg" alt="Gnu Screen" /></a>
</div>

<p>ターミナルマルチプレクサであるGNU Screenの安定版がアップデートされ、4.7.0がリリースされました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#gnu-screen-470" id="markdown-toc-gnu-screen-470">GNU Screen 4.7.0</a></li>
  <li><a href="#アップデート内容" id="markdown-toc-アップデート内容">アップデート内容</a></li>
  <li><a href="#homebrewでアップデート" id="markdown-toc-homebrewでアップデート">Homebrewでアップデート</a></li>
  <li><a href="#screenutf8" id="markdown-toc-screenutf8">screenutf8</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>
  <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3802317723662375" data-ad-slot="5762198341"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="gnu-screen-470">GNU Screen 4.7.0</h2>

<p>ちょっと前になってしまいますが、10月1日にアナウンスがありました。</p>

<blockquote>
  <p><a href="https://savannah.gnu.org/forum/forum.php?forum_id=9566">GNU Screen - News: GNU Screen v.4.7.0 [Savannah]</a></p>
</blockquote>

<blockquote>
  <p><a href="https://git.savannah.gnu.org/cgit/screen.git/log/?h=v.4.7.0">screen.git - screen</a></p>
</blockquote>

<p>4.2.0が6年ぶりに2014年にメジャーアップデートでリリースされ、
4.3.0、4.4.0が1年おきにリリースされ、その後4.5.0、4.6.0は半年おきにリリースされていました。
4.6.0が2017年1月だったので今回の4.7.0は2年以上経ってのリリースになります。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2015/06/29/computer-screen-mac/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/20150629_screen.gif" width="120" height="90" alt="20150629_screen" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2015/06/29/computer-screen-mac/">GNU Screen v4.3.0がリリースされてたのでHomebrew at Macでアップデート</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/9888381393?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=9888381393&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/41W1R2icCsL._SS90_CR0,0,120,90_.jpg" alt="Gnu Screen: The Virtual Terminal Manager" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/06/30/computer-screen/">GNU screen 4.6.0リリース</a></div></li></ul>

<p>Gitの履歴だけ見るとそれほどアクティブさが減ってる感じもないですが、
特に目玉的な追加機能ができたわけではなかったのでリリースまではせずに来たけど
色々細かいことが溜まってきたので今回のリリース、といったところでしょうか？</p>

<h2 id="アップデート内容">アップデート内容</h2>

<p>内容としては</p>

<ul>
  <li>Adds support for SGR (1006) mouse mode</li>
  <li>Adds support for OSC 11</li>
  <li>Updates Unicode ambiguous and wide tables to 12.1.0</li>
  <li>Fixes:
    <ul>
      <li>cross-compilation support (bug #43223)</li>
      <li>a lot of manpage fixes and cleanups</li>
    </ul>
  </li>
</ul>

<p>と言った感じで特別大きな機能の追加などはありません。</p>

<p>多くの人が恩恵を受ける項目としてはmanpageが更新された、というところでしょうか。</p>

<h2 id="homebrewでアップデート">Homebrewでアップデート</h2>

<p>Homebrewなどでも4日位に<a href="https://github.com/Homebrew/homebrew-core/blob/master/Formula/screen.rb">フォーミュラ</a>がアップデートされています。</p>

<h2 id="screenutf8">screenutf8</h2>

<p>GNU screenは日本語が苦手なところがあり、今までのリリースに対しては
パッチを当てて使ってきていました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2013/03/22/screen-install/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20130322_screen_char_non_120_90.jpg" width="120" height="90" alt="20130322_screen_char_non_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/03/22/screen-install/">Macでの文字化け対策用のGNU screenのインストール</a></div></li></ul>

<p>一応4.6.0のときにも確認してだめだな、と思ってパッチ用のFormulaをアップデートして使ってきたのですが、
今確認してみると特に問題が見えませんでした。(4.6.0でも4.7.0でも)</p>

<p>上でテストしている<strong>/ユーザーズガイドと情報</strong>という日本語フォルダは今は無いのですが、
同じ様なものを作って見てみても問題ありません。</p>

<p>これをiTerm2/ターミナル.app両方で問題なし。</p>

<p>Macに元々入っている(/usr/bin/screen)は古い(4.0.3)ものですが、確かもともとなにかパッチが当たった状態で
最初から文字化けは起こさなかったと思いますが、今見ても問題はありません。</p>

<p>ターミナル.appだと何かしら問題が良く見えたと思うのですが、
今の所見えないのでHomebrewでも<code>screen</code>フォーミュラを使おうと思います。</p>

<blockquote>
  <p><a href="https://github.com/rcmdnk/homebrew-rcmdnkpac">rcmdnk/homebrew-rcmdnkpac: Repository for Homebrew Tap, including Formulae of rcmdnk’s packages.</a></p>
</blockquote>

<p>ここにあるscreenutf8は4.6.2のままにしておきます。
4.7.0に対応させるにはパッチを作り直さないといけないので。</p>

<p>もし、Homebrewで入れられる<code>screen</code>で文字化けなどの問題が起こったら教えて頂たらまた見てみたいと思います。</p>

<div class="postscript">
  <p><strong>追記: 2019/11/19 </strong></p>

  <p>すいません、やっぱり文字化け起こすのでアップデートして</p>

  <pre><code>$ brew install rcmdnk/rcmdnkpac/screenutf8
</code></pre>

  <p>で対策版をインストール出来る様にしておきました。</p>

  <ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2019/11/19/computer-mac-screen/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20191119_macutf3_120_90.jpg" width="120" height="90" alt="20191119_macutf3_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2019/11/19/computer-mac-screen/">Macで濁点とかが起こす文字化け問題について</a></div></li></ul>

  <p><strong>追記ここまで</strong></p>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DHCPでホスト名が配られる環境にノートPCを持っていた時に起こった問題]]></title>
    <link href="https://rcmdnk.com/blog/2018/08/21/computer-network-screen/"/>
    <updated>2018-08-21T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/08/21/computer-network-screen</id>
    <content type="html"><![CDATA[<div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/5510882581?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=5510882581&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/41Ssi-E3KEL._SS200_.jpg" alt="Hostname" /></a>
</div>

<p>ノートパソコンを持ち歩いていろいろなところのWi-Fiで作業することが多いですが
ネットワークによってはDHCPでホスト名も配っているところがあります。</p>

<p>そんなところに繋いだり他で作業したりしてる間にちょっと問題が起こりました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#macのローカルホスト名" id="markdown-toc-macのローカルホスト名">Macのローカルホスト名</a></li>
  <li><a href="#ホスト名が変わる" id="markdown-toc-ホスト名が変わる">ホスト名が変わる</a></li>
  <li><a href="#起こった問題" id="markdown-toc-起こった問題">起こった問題</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>
  <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3802317723662375" data-ad-slot="5762198341"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="macのローカルホスト名">Macのローカルホスト名</h2>

<p>Macでの話ですが、システム環境設定の<strong>共有</strong>から<strong>コンピューター名</strong>を決めることが出来、
通常この値に<code>MyMac</code>とか入れておくと、</p>

<pre><code>$ hostname
MyMac.local
</code></pre>

<p>といった<code>.local</code>を付けたホスト名として認識されます。</p>

<p>これ以外に、Mac特有のツールで</p>

<pre><code>$ scutil --get ComputerName
MyMac
$ scutil --get LocalHostName
MyMac
$ HostName
MyMac.local
</code></pre>

<p>と、<code>scutil</code>を使っても確かめることが出来ます。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/B00LYTZROA?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=B00LYTZROA&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/51HkL2NY6eL._SS90_CR0,0,120,90_.jpg" alt="My IP" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/12/09/computer-mac/">Mac 10.10 Yosemiteでのホスト名の設定</a></div></li></ul>

<h2 id="ホスト名が変わる">ホスト名が変わる</h2>

<p>これがDHCPサーバー側からホスト名が配られる様な設定になっていると、
<code>hostname</code>の結果がその指定してきたものに変わってきます。</p>

<pre><code>$ hostname
example.host
</code></pre>

<p>一方<code>scutil</code>の結果は</p>

<pre><code>$ scutil --get ComputerName
MyMac
$ scutil --get LocalHostName
MyMac
$ scutil --get HostName
HostName: not set
</code></pre>

<p>といった具合に、<code>ComputerName</code>、<code>LocalHostName</code>は相変わらず同じ名前を出す一方、
<code>HostName</code>は<code>not set</code>になっています。</p>

<h2 id="起こった問題">起こった問題</h2>

<p>今回起こったのはGNU screenのソケットディレクトリの設定に関してです。</p>

<p>通常、<strong>/tmp/uscreens/S-user</strong>の様なところに設定してありますが、
<code>SCREENDIR</code>という環境変数で変更することが出来、これを</p>

<pre><code>SCREENDIR=$HOME/.screen_$(hostname|cut -d. -f1
</code></pre>

<p>みたいな値に設定していました。</p>

<p>これは<strong>/tmp</strong>に置くのが嫌なのと、分散サーバーみたいなところでHOMEを共有している場所で、
他の端末でscreenを立ち上げてる時にさっと<code>ls ~/.screen_*</code>みたいにすると
どこで立ち上がってるか簡単に確認出来る様にするためです。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/1895636426?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=1895636426&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/51Bh8%2BDwK9L._SS90_CR0,0,120,90_.jpg" alt="Socket" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/05/04/computer-screen-socket/">GNU screenでのソケットディレクトリについて</a></div></li></ul>

<p>Macではホスト名を付ける必要は特にないのですが、
<a href="https://github.com/rcmdnk/dotfiles">dotfiles</a>
で共通のものを使ってるので持ち運び端末でも同じ様にホスト名のついたソケットディレクトリを使っていました。</p>

<p>ここで、ある環境で<code>hostname</code>が<code>Mymac.local</code>の所でターミナルを立ち上げ、
その後、DHCPでホスト名(<code>example.host</code>)が配られる環境に接続後、立ち上げ済のターミナルからGNU screenを立ち上げると</p>

<pre><code>$ screen -ls
No Sockets found in /Users/user/.screen_example
</code></pre>

<p>といった感じで中からscreenの情報が取れません。</p>

<p>これは、GNU screenを立ち上げるターミナルでは<code>SCREENDIR</code>がターミナル立ち上げ立ち上げ時に設定された
<code>~/.screen_MyMac</code>であるのに対し、
立ち上げ後にscreen内で起動するBashは<code>SCREENDIR</code>を<code>~/.screen_example</code>と設定してしまうからです。</p>

<p>これに対処するためにMacにおいては<code>scutil</code>を使うように変更しました。</p>

<figure class="code"><figcaption><span>.bashrc </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span></span><span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$OSTYPE</span><span class="s2">&quot;</span> <span class="o">=</span>~ darwin <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
</span><span class="line">  <span class="nb">export</span> <span class="nv">SCREENDIR</span><span class="o">=</span><span class="nv">$HOME</span>/.screen_<span class="k">$(</span>scutil --get ComputerName<span class="k">)</span>
</span><span class="line"><span class="k">else</span>
</span><span class="line">  <span class="nb">export</span> <span class="nv">SCREENDIR</span><span class="o">=</span><span class="nv">$HOME</span>/.screen_<span class="k">$(</span>hostname<span class="p">|</span>cut -d. -f1<span class="k">)</span>
</span><span class="line"><span class="k">fi</span>
</span><span class="line"><span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">&quot;</span><span class="nv">$SCREENDIR</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span><span class="line">  mkdir -p <span class="s2">&quot;</span><span class="nv">$SCREENDIR</span><span class="s2">&quot;</span>
</span><span class="line"><span class="k">fi</span>
</span><span class="line">chmod <span class="m">700</span> <span class="s2">&quot;</span><span class="nv">$SCREENDIR</span><span class="s2">&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>WindowsのノートPCに関してはどうするか、ちょっとまだ考え中です。
<code>cygwin</code>ならまだ条件分岐出来ますが、
最近使えるようになったUbuntu on Windowsとか
そもそも区別し辛いものだと辛い。</p>

<p>今のところこれ以外にホスト名に頼って直接何かするような設定はなさそうなんですが、
結構こういうことは起こりそうなので気をつけて見ていかないと、と。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GNU Screen 4.6.1リリース]]></title>
    <link href="https://rcmdnk.com/blog/2017/07/11/computer-screen/"/>
    <updated>2017-07-11T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2017/07/11/computer-screen</id>
    <content type="html"><![CDATA[<div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/9888381393?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=9888381393&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/41W1R2icCsL._SS200_.jpg" alt="Gnu Screen: The Virtual Terminal Manager" /></a>
</div>

<p>2週間程前に4.6.0がリリースされたGNU screenですが
リリース直後から色々とバグ報告がされていて
それを直した4.6.1がリリースされました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#gnu-screen-461" id="markdown-toc-gnu-screen-461">GNU Screen 4.6.1</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>
  <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3802317723662375" data-ad-slot="5762198341"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="gnu-screen-461">GNU Screen 4.6.1</h2>

<p>今回のリリースはバグフィックスのためのパッチリリースです。</p>

<blockquote>
  <p><a href="http://savannah.gnu.org/forum/forum.php?forum_id=8904">GNU Screen - News: GNU Screen v.4.6.1 [Savannah]</a></p>
</blockquote>

<p>4.6.0のアップデートではコピーモード時のスクロールバックに関する
アップデート等がありました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/9888381393?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=9888381393&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/41W1R2icCsL._SS90_CR0,0,120,90_.jpg" alt="Gnu Screen: The Virtual Terminal Manager" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/06/30/computer-screen/">GNU screen 4.6.0リリース</a></div></li></ul>

]]></content>
  </entry>
  
</feed>
