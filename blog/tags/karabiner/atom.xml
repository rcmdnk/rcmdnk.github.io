<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Karabiner | rcmdnk's blog]]></title>
  <link href="https://rcmdnk.com/blog/tags/karabiner/atom.xml" rel="self"/>
  <link href="https://rcmdnk.com/"/>
  <updated>2018-08-23T00:51:36+00:00</updated>
  <id>https://rcmdnk.com/</id>
  <author>
    <name><![CDATA[rcmdnk]]></name>
    <email><![CDATA[rcmdnk@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Karabiner-Elementsに長押し操作やマウスキー機能が追加されていた]]></title>
    <link href="https://rcmdnk.com/blog/2018/02/17/computer-karabiner/"/>
    <updated>2018-02-17T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2018/02/17/computer-karabiner</id>
    <content type="html"><![CDATA[<p>macOS SierraになってからKarabinerに取って代わったKarabiner-Elementsですが
色々と進化していてKarabinerで出来ていた様な事は大体出来るようになっているみたいです。</p>

<p>むしろ色々と出来ることが多くなってる様子。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#マニュアル" id="markdown-toc-マニュアル">マニュアル</a></li>
  <li><a href="#to_if_held_down" id="markdown-toc-to_if_held_down">to_if_held_down</a></li>
  <li><a href="#mouse_key" id="markdown-toc-mouse_key">mouse_key</a></li>
  <li><a href="#まとめ" id="markdown-toc-まとめ">まとめ</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="マニュアル">マニュアル</h2>

<p>最初使い始めた頃はマニュアル的なものも無かったので
Exampleを見たりソースコードを直接見たりして調べてましたが
現在は結構充実したマニュアルが存在します。</p>

<blockquote>
  <p><a href="https://pqrs.org/osx/karabiner/json.html">karabiner.json Reference Manual - Karabiner - Software for macOS</a></p>
</blockquote>

<p>どの様なキーが使えるか一通り載っています。</p>

<p>また、いくつか例も載っているので大体のことは
ここを見れば出来る様になると思います。</p>

<h2 id="to_if_held_down">to_if_held_down</h2>

<p>12月30日リリースの11.5.0で入った様ですが、
通常の<code>to</code>の代わりに
<code>to_if_held_down</code>という
キーを使うとキーを一定時間押していた場合に
別のキーを送れる様になります。
<code>to_if_alone</code>の値を指定するとすぐに離した場合はこちらが送られます。</p>

<p>これを使って以下の様な設定をしています。</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span></span>    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;For HHKB ((Shift-)Esc to grave accent (tilde))&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;manipulators&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;escape&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;optional&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;any&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;basic.to_if_alone_timeout_milliseconds&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;basic.to_if_held_down_threshold_milliseconds&quot;</span><span class="p">:</span> <span class="mi">250</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to_if_alone&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;grave_accent_and_tilde&quot;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">],</span>
</span><span class="line">          <span class="nt">&quot;to_if_held_down&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;escape&quot;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">],</span>
</span><span class="line">          <span class="nt">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;device_if&quot;</span><span class="p">,</span>
</span><span class="line">              <span class="nt">&quot;identifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="p">{</span>
</span><span class="line">                  <span class="nt">&quot;vendor_id&quot;</span><span class="p">:</span> <span class="mi">2131</span>
</span><span class="line">                <span class="p">}</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">}</span><span class="err">,</span>
</span></code></pre></td></tr></table></div></figure>

<p>HHKBでは<i class="key">TAB</i>の上に<i class="key">ESC</i>があります。
通常のキーボードではここに<i class="key">`</i>があるので
ちょっと癖が強いです。</p>

<p>そこで、この設定によりHHKBの場合は<i class="key">ESC</i>を押してすぐ話す場合には
<code>`</code>、長押しした場合には<code>ESC</code>が送られる様にしてあります。</p>

<p>途中にある<code>parameters</code>によって250ms以上押せば<code>ESC</code>が送られる設定になっています。</p>

<p>この設定をしていますが、<code>ESC</code>は<i class="key">⌃</i>-<i class="key">[</i>でも送れる様に
設定してあって通常はこっちを使います(Vim like)。</p>

<h2 id="mouse_key">mouse_key</h2>

<p>mouse_keyというものがもうちょっと前に実装されていて、
これによってマウスカーソルを動かしたり
スクロールをキーに割り当てたりすることが可能になります。</p>

<p>これまで、同じことをAppleScriptを使って動作させ、
これを<code>shell_command</code>で呼ぶようにしていましたが、
これだとキーを押し続けた時にリピートして動いてくれませんでした。</p>

<p>今回、<code>mouse_key</code>を試してみた所押しっぱなしにすると
カーソルが動き続ける様になったので嬉しいところ。</p>

<p>以下の様な感じで<i class="key">⌃</i>-<i class="key">⇧</i>-<i class="key">H</i>/<i class="key">J</i>/<i class="key">K</i>/<i class="key">L</i>
で左下上右にカーソルを動かせる様にしています。</p>

<p>ついでに<i class="key">⌃</i>-<i class="key">⇧</i>-<i class="key">N</i>/<i class="key">M</i>/<i class="key">P</i>で
左クリック/中クリック/右クリックが出来る様になっています。</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span></span>    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Mouse cursor move using Karabiner&#39;s functions&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;extra_descriptions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="s2">&quot;Mouse move using Karabiner&#39;s functions&quot;</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;manipulators&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
</span><span class="line">                <span class="s2">&quot;shift&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mouse_key&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">                <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="mi">-1536</span>
</span><span class="line">              <span class="p">}</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;j&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
</span><span class="line">                <span class="s2">&quot;shift&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mouse_key&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">                <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="mi">1536</span>
</span><span class="line">              <span class="p">}</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
</span><span class="line">                <span class="s2">&quot;shift&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mouse_key&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">                <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="mi">-1536</span>
</span><span class="line">              <span class="p">}</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
</span><span class="line">                <span class="s2">&quot;shift&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mouse_key&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">                <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1536</span>
</span><span class="line">              <span class="p">}</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
</span><span class="line">                <span class="s2">&quot;shift&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;pointing_button&quot;</span><span class="p">:</span> <span class="s2">&quot;button1&quot;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
</span><span class="line">                <span class="s2">&quot;shift&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;pointing_button&quot;</span><span class="p">:</span> <span class="s2">&quot;button3&quot;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">                <span class="s2">&quot;control&quot;</span><span class="p">,</span>
</span><span class="line">                <span class="s2">&quot;shift&quot;</span>
</span><span class="line">              <span class="p">]</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">},</span>
</span><span class="line">          <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;pointing_button&quot;</span><span class="p">:</span> <span class="s2">&quot;button2&quot;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">}</span><span class="err">,</span>
</span></code></pre></td></tr></table></div></figure>

<h2 id="まとめ">まとめ</h2>

<p>上の設定とかは下のページの<code>Personal Settings</code>から取ってこれます。</p>

<blockquote>
  <p><a href="https://rcmdnk.com/KE-complex_modifications/">Karabiner-Elements complex_modifications rules by rcmdnk</a></p>
</blockquote>

<p>実際には
<a href="https://github.com/pqrs-org/KE-complex_modifications">KE-complex_modifications</a>
をForkしてerb形式で書いて作っています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/08/30/computer-mac-karabiner/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170830_vimode_120_90.jpg" width="120" height="90" alt="20170830_vimode_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/08/30/computer-mac-karabiner/">KE-complex_modificationsを使ってKarabiner-Elementsの定義を色々作って公開する</a></div></li></ul>

<p>Karabinerでも作ってたVim emulationも同じページにあります。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170905_vimemu_120_90.jpg" width="120" height="90" alt="20170905_vimemu_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/">Vim以外でVimする: Mac+Karabiner-Elements編</a></div></li></ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Karabiner-Elementsで日本語入力状態を把握してキー設定出来る様になった]]></title>
    <link href="https://rcmdnk.com/blog/2017/10/30/computer-mac-karabiner/"/>
    <updated>2017-10-30T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2017/10/30/computer-mac-karabiner</id>
    <content type="html"><![CDATA[<div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/4774149934?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=4774149934&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/51DjOK-jLoL._SS200_.jpg" alt="日本語入力を支える技術　～変わり続けるコンピュータと言葉の世界 (WEB+DB PRESS plus)" /></a>
</div>

<p>Macのキー設定アプリの
<a href="https://github.com/tekezo/Karabiner-Elements">Karabiner-Elements</a>
でIMEの状態を見て日本語入力状態かどうか等を判断して
キー設定を出来る様になった様です。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#input_source_ifunless" id="markdown-toc-input_source_ifunless">input_source_if/unless</a></li>
  <li><a href="#vimでnormalモード切り替え時にimeをoffにする" id="markdown-toc-vimでnormalモード切り替え時にimeをoffにする">VimでNormalモード切り替え時にIMEをOFFにする</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="input_source_ifunless">input_source_if/unless</h2>

<p>現在はまだベータ版のみですが、<code>input_source</code>も加わりました。
以前Karabinerで出来た様にIMEの状態等を見て判断することも可能になりました。</p>

<blockquote>
  <p><a href="https://github.com/tekezo/Karabiner-Elements/blob/master/NEWS.md">Karabiner-Elements/NEWS.md</a></p>
</blockquote>

<p>ベータ版はKarabiner-Elementsの環境設定で<strong>Misc</strong>タブに行って
<code>Check for beta updates</code>を行うとインストールすることが出来ます。</p>

<p>現在のベータ版は11.1.11になります。</p>

<p>新しくシステムにアクセスする部分があるためか、アップデート後起動する時に
セキュリティーに関して聞かれ、システム環境設定の<strong>セキュリティーとプライバシー</strong>の<strong>一般</strong>タブで許可を行う必要があります。起動時のウィザードで開かれるのが
<strong>プライバシー</strong>タブなのでちょっと戸惑いましたが<strong>一般</strong>タブで許可することが出来ます。</p>

<p>定義としてはこんな感じで行います。</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span></span><span class="s2">&quot;conditions&quot;</span><span class="err">:</span> <span class="p">[</span>
</span><span class="line">  <span class="p">{</span>
</span><span class="line">    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;input_source_if&quot;</span><span class="p">,</span>
</span><span class="line">    <span class="nt">&quot;input_sources&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">      <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;input_source_id&quot;</span><span class="p">:</span> <span class="s2">&quot;^com\\.apple\\.keylayout\\.US$&quot;</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;input_mode_id&quot;</span><span class="p">:</span> <span class="s2">&quot;^com\\.apple\\.inputmethod\\.Japanese\\.FullWidthRoman&quot;</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;^en$&quot;</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">    <span class="p">]</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>もし、IMEの状態で日本語入力モードになっている時、を指定したい時は</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span></span><span class="p">{</span>
</span><span class="line">  <span class="nt">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;ja&quot;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>を使えばOK。
これらの指定は指定文字列を含む場合、といった感じで指定されるらしく、
<code>^</code>、<code>$</code>は正規表現で文頭、文末なので上の<code>^en$</code>では<code>en</code>を含む様な文字列は除き<code>en</code>のみの場合のみに適用されます。
<code>ja</code>でもそうした方が確実ですが、通常英語以外とは一緒に使わないでしょうし、
<code>ja</code>を含む他のものも多分無いので大概の場合<code>ja</code>だけで大丈夫。</p>

<p>今の状態がどの様なものか、というのはKarabiner-EventViewerで
<strong>Variables</strong>のタブで<code>input_source_identifiers</code>としてチェックできます。</p>

<pre><code>"input_source_identifiers": {
  "input_mode_id": "com.apple.inputmethod.Roman",
  "input_source_id": "com.google.inputmethod.Japanese.Roman",
  "language": "en"
},
</code></pre>

<p>とか(Google日本語入力英数)</p>

<pre><code>"input_source_identifiers": {
  "input_mode_id": "com.apple.inputmethod.Japanese",
  "input_source_id": "com.google.inputmethod.Japanese.base",
  "language": "ja"
},
</code></pre>

<p>とか(Google日本語入力ひらがな)</p>

<pre><code>"input_source_identifiers": {
  "input_mode_id": "com.apple.inputmethod.Japanese",
  "input_source_id": "com.apple.inputmethod.Kotoeri.Japanese",
  "language": "ja"
},
</code></pre>

<p>とか(Apple日本語入力ひらがな)。</p>

<p>AppleのIMEは<strong>ことえり</strong>という名前を出さなくなりましたが中の識別子としては<code>Kotoeri</code>な様です。</p>

<blockquote>
  <p><a href="https://github.com/pqrs-org/KE-complex_modifications/blob/master/docs/json/example_input_source.json">KE-complex_modifications/example_input_source.json</a></p>
</blockquote>

<blockquote>
  <p><a href="https://github.com/tekezo/Karabiner-Elements/blob/master/tests/src/manipulator_conditions/json/input_source.json">Karabiner-Elements/input_source.json</a></p>
</blockquote>

<p>また、IMEの状態を買えるために英数入力にするだけなら<code>"key_code": "japanese_eisuu"</code>を使えば
変更が出来ますが、
それ以外に色々やりたいときなど、<code>select_input_source</code>という入力が使える様になっています。</p>

<blockquote>
  <p><a href="https://github.com/pqrs-org/KE-complex_modifications/blob/master/docs/json/example_select_input_source.json">KE-complex_modifications/example_select_input_source.json</a></p>
</blockquote>

<h2 id="vimでnormalモード切り替え時にimeをoffにする">VimでNormalモード切り替え時にIMEをOFFにする</h2>

<p>これによってVimでのIME OFFの設定が以前Karabinerでやっていたのと同じ様に出来るようになりました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/08/31/computer-mac-vim/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170831_escime_120_90.jpg" width="120" height="90" alt="20170831_escime_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/08/31/computer-mac-vim/">VimでNormalモード切り替え時にIMEをOFFにする、をMacでKarabiner-Elementsを使って実現する</a></div></li></ul>

<p>以前はどの状態でも<i class="key">ESC</i>を押した際、
<i class="key">EISU</i>、<i class="key">ESC</i>、<i class="key">ESC</i>を実行する様にしていました。</p>

<p><i class="key">EISU</i>自体は英数入力の状態であれば何もしないのでそれほど問題のない設定です。</p>

<p><i class="key">ESC</i>を二回してるのは変換中とかに押した時に中途半端に英数状態に戻してInsertモードに残るのを避けたいため。</p>

<p>ここを一回にしておけば通常の<i class="key">ESC</i>と全く同じなので問題なのですが、
二回にしようとするとちょっと問題が出ます。</p>

<p>問題になるのはGNU screenでのコピーモード。
コピーモードには<i class="key">Prefix</i>+<i class="key">ESC</i>で入りますが、
コピーモード中に<i class="key">ESC</i>を押すとコピーモードを終了します。</p>

<p>つまり二回押すと始まった瞬間に終わります。</p>

<p>これを避けるために<strong>.screenrc</strong>に</p>

<pre><code>bindkey -m ^[ eval ''
</code></pre>

<p>と、コピーモード時に<i class="key">ESC</i>は何もしないような設定を入れてました。</p>

<p>これでもそれ程困ってませんでしたが、せっかく<code>input_source_if</code>が出来たのでそれを使って作り直しました。</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span></span><span class="p">{</span>
</span><span class="line">  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;ESC sends EISU ESC ESC when language is ja&quot;</span><span class="p">,</span>
</span><span class="line">  <span class="nt">&quot;manipulators&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;escape&quot;</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;japanese_eisuu&quot;</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;escape&quot;</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;escape&quot;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;input_source_if&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;input_sources&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;ja&quot;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">  <span class="p">]</span>
</span><span class="line"><span class="p">}</span><span class="err">,</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Control-[ sends EISU ESC ESC when language is ja&quot;</span><span class="p">,</span>
</span><span class="line">  <span class="nt">&quot;manipulators&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;open_bracket&quot;</span><span class="p">,</span>
</span><span class="line">        <span class="nt">&quot;modifiers&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;mandatory&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="s2">&quot;control&quot;</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;japanese_eisuu&quot;</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;escape&quot;</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;escape&quot;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;input_source_if&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;input_sources&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">              <span class="nt">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;ja&quot;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">  <span class="p">]</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p><i class="key">ESC</i>と<i class="key">⌃</i>-<i class="key">[</i>について設定。</p>

<p>この設定は以下のページからもインポートできます。</p>

<p><a href="https://rcmdnk.com/KE-complex_modifications/">/KE-complex_modifications/</a></p>

<p>ただし、このページにある<code>ESC sends EISU ESC ESC when language is ja</code>とかは
ターミナルやVim上だけで有効になるようになっています。</p>

<p>これはVim emulationとの競合を避けるためですが、まあ他の場所では必要ないと思うので。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170905_vimemu_120_90.jpg" width="120" height="90" alt="20170905_vimemu_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/">Vim以外でVimする: Mac+Karabiner-Elements編</a></div></li></ul>

<p>ちなみにオフィシャルKarabiner-Elements complex_modificationsにも
<i class="key">EISU</i>、<i class="key">ESC</i>だけを送る設定があります。</p>

<blockquote>
  <p><a href="https://pqrs.org/osx/karabiner/complex_modifications/#International">Karabiner-Elements complex_modifications rules</a></p>
</blockquote>

<div class="postscript">
  <p><strong>追記: 2017/11/06 </strong></p>

  <p>OSアップデートで10.13.1になり、それが原因かどうか定かではありませんが、
アップデートの再起動後、
<i class="key">Ctrl</i>-<i class="key">[</i>でVimのノーマルモードに戻る際に何か変だな、と思ったら日本語入力のままになっていて
調べてみた所
<code>input_source_identifiers</code>がIMEの切り替えをしても変更されなくなってました。</p>

  <p>普段はGoogle日本語入力だけの<strong>ひらがな</strong>と<strong>英数</strong>を使っています。</p>

  <ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2014/05/23/computer-mac/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20140523_mac_ime_1_120_90.jpg" width="120" height="90" alt="20140523_mac_ime_1_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2014/05/23/computer-mac/">Macで入力ソースにいつの間にかU.S.が入ってきて消せない時の対処法</a></div></li></ul>

  <p>Karabiner-Elementsをアップデートして再起動したりOSを再起動しても上手くいきませんでしたが、
通常Google日本語入力だけの<strong>ひらがな</strong>と<strong>英数</strong>を使っている所、
一度キーボードの環境設定からAppleの<strong>日本語</strong>(ことえり)を追加して切り替えたりしてみたところ
<code>input_source_identifiers</code>が変更される様になり、
<strong>日本語</strong>を削除しても変更がちゃんと反映される様になりました。</p>

  <p>何かしら特殊な条件が重なっただけかもしれませんが、
<code>input_source_if</code>などの設定が上手く動かない、という場合には
Karabiner-EventViewerでチェックして、
もし<code>input_source_identifiers</code>が動かない様であれば
他の言語を入力ソースに追加していじってみるときちんと動き出す可能性があります。</p>

  <p><strong>追記ここまで</strong></p>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac Finder/Safari/プレビュー等でタブ間移動するショートカットを変更する]]></title>
    <link href="https://rcmdnk.com/blog/2017/10/10/computer-mac-karabiner/"/>
    <updated>2017-10-10T13:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2017/10/10/computer-mac-karabiner</id>
    <content type="html"><![CDATA[<p>MacのFinder等にはタブ機能が付いていますが、
その移動ショートカットキーが
ちょっと他の設定と競合したりして使いづらかったので
調整した話。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#macのアプリケーションのタブ間移動キー" id="markdown-toc-macのアプリケーションのタブ間移動キー">Macのアプリケーションのタブ間移動キー</a></li>
  <li><a href="#firefoxgoogle-chromeのタブ移動キー" id="markdown-toc-firefoxgoogle-chromeのタブ移動キー">Firefox/Google Chromeのタブ移動キー</a></li>
  <li><a href="#タブ移動キーをkarabiner-elementsで設定する" id="markdown-toc-タブ移動キーをkarabiner-elementsで設定する">タブ移動キーをKarabiner-Elementsで設定する</a></li>
  <li><a href="#タブ移動キーを環境設定から設定する" id="markdown-toc-タブ移動キーを環境設定から設定する">タブ移動キーを環境設定から設定する</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="macのアプリケーションのタブ間移動キー">Macのアプリケーションのタブ間移動キー</h2>

<p>Mac純正のアプリケーションであるFinderやSafari、またプレビューなども
最近はタブ機能を持っています。</p>

<p>複数のタブを開いた時に、次(右)のタブに移動したり前(左)のタブに移動するショートカットキーは</p>

<ul>
  <li>次のタブを表示 (Select Next Tab)     : <i class="key">⌃</i>-<i class="key">TAB</i>または<i class="key">⌘</i>-<i class="key">⇧</i>-<i class="key">]</i></li>
  <li>前のタブを表示 (Select Previous Tab) : <i class="key">⌃</i>-<i class="key">⇧</i>-<i class="key">TAB</i>または<i class="key">⌘</i>-<i class="key">⇧</i>-<i class="key">[</i></li>
</ul>

<p>となっています。</p>

<p>Finderとかを出してメニューバーの<strong>ウィンドウ</strong>を開くと上のショートカットのうち前者の<i class="key">TAB</i>を使ったものだけが
表示されていますが後者も使えます。</p>

<blockquote>
  <p><a href="https://support.apple.com/ja-jp/guide/safari/cpsh003">キーボードおよびその他のショートカット - Apple サポート</a></p>
</blockquote>

<p>Finderなどでも最近では積極的にタブを使うようになったのでその辺のショートカットキーもちゃんと整理したい、というのが今回の話です。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/04/07/computer-mac/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170407_dock_120_90.jpg" width="120" height="90" alt="20170407_dock_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/04/07/computer-mac/">Macでフォルダを常に新しいタブで開く: DockやSpotlight、またコマンドライのopenコマンドからも</a></div></li></ul>

<h2 id="firefoxgoogle-chromeのタブ移動キー">Firefox/Google Chromeのタブ移動キー</h2>

<ul>
  <li>次のタブを表示 (Select Next Tab)     : <i class="key">⌃</i>-<i class="key">TAB</i>または<i class="key">⌃</i>-<i class="key DOWN">PAGE</i>または<i class="key">⌘</i>-<i class="key">⌥</i>-<i class="key">⇢</i>または<i class="key">⌘</i>-<i class="key">⇧</i>-<i class="key">]</i></li>
  <li>前のタブを表示 (Select Previous Tab) : <i class="key">⌃</i>-<i class="key">⇧</i>-<i class="key">TAB</i>または<i class="key">⌃</i>-<i class="key UP">PAGE</i>または<i class="key">⌘</i>-<i class="key">⌥</i>-<i class="key">⇠</i>または<i class="key">⌘</i>-<i class="key">⇧</i>-<i class="key">[</i></li>
</ul>

<p>Firefoxではメニューにタブ移動の項目はありませんが、
それぞれの前3つについてはFirefoxのヘルプに載っています。</p>

<blockquote>
  <p><a href="https://support.mozilla.org/ja/kb/keyboard-shortcuts-perform-firefox-tasks-quickly">Firefox のキーボードショートカット  Firefox ヘルプ</a></p>
</blockquote>

<p>最後のMacのアプリと同様の方法は載っていませんが
少なくとも手元のmacOS High Sierraでは同様にタブの切り替えが出来るのを確認しました。</p>

<p>またGoogle Chromeはメニューに<i class="key">⌘</i>-<i class="key">⌥</i>-Xのものが載っていて
ヘルプにもそれしか載っていませんが
上の全てで移動できるのを確認しました。</p>

<blockquote>
  <p><a href="https://support.google.com/chrome/answer/157179?hl=ja">Chrome のキーボード ショートカット - Google Chrome ヘルプ</a></p>
</blockquote>

<p>逆にこれらの方法の中で上のMacの方に無いショートカットキーを持ってSafariなどで移動することが出来ないのも確認しています。</p>

<h2 id="タブ移動キーをkarabiner-elementsで設定する">タブ移動キーをKarabiner-Elementsで設定する</h2>

<p>基本的にはMacのアプリで出来る移動方法ならどのアプリでも移動できる、と考えて良いと思います。</p>

<p>また、Windowsなどでも、一般的なのは<i class="key">⌃</i>-(<i class="key">⇧</i>-)<i class="key">TAB</i>かな、と思います。</p>

<p>なのでそうしたいのですが、HyperSwitchというアプリ切り替えアプリを使っていて、
これを<i class="key">⌃</i>-<i class="key">TAB</i>にあてているため使えません。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2015/03/17/computer-mac-iterm2/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/MacApp/thumbnail/iTerm2_120_90.png" width="120" height="90" alt="iTerm2_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2015/03/17/computer-mac-iterm2/">MacでiTerm2上でHyperSwitch等が使えない問題が治っていたのでターミナルからiTerm2へ出戻りした</a></div></li></ul>

<p>そもそも何故これにアプリ切り替えをあてているかというと、
<i class="key">⌘</i>と<i class="key">⌃</i>を入れ替えてるため、
所謂一般的なWindowsの<i class="key">Alt</i>-<i class="key">TAB</i>的な押し方が
<i class="key">⌃</i>-<i class="key">TAB</i>
になるためです。</p>

<p>Windowsの方でもキー切り替えを行ってるのでアプリの切り替えは <i class="key">Ctrl</i>-<i class="key">TAB</i>に当てなおしています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/0984333924?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=0984333924&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/413lC0hqeYL._SS90_CR0,0,120,90_.jpg" alt="Control Alt Delete Leadership (英語)" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/06/14/computer-windows-mac-bash/">Alt(Cmd)とControlの交換</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail"><div class="amazon-img">
  <a href="//www.amazon.co.jp/gp/product/B002VILLIO?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=B002VILLIO&amp;linkCode=shr&amp;tag=rcmdnk0c-22" rel="nofollow" target="_blank"><img src="https://images-na.ssl-images-amazon.com/images/I/61miKKT5aUL._SS90_CR0,0,120,90_.jpg" alt="ザムスト(ZAMST) 親指 サポーター サムガード バレー バスケ M~Lサイズ 左右兼用 ブラック" /></a>
</div></div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/10/10/computer-windows-mac-bash/">親指Controlのすすめ</a></div></li></ul>

<p>逆にタブの切替に使う<i class="key">⌃</i>-<i class="key">TAB</i>にあたる配置に
<i class="key">⌘</i>-<i class="key">TAB</i>
が来てるわけですが
(もちろん<i class="key Lock">Caps</i>があるキーボードでは<i class="key">⌘</i>は<i class="key Lock">Caps</i>の位置に修正)、
このキーを単に<i class="key">⌃</i>-<i class="key">TAB</i>に割り当てる、
みたいなことをするとHyperSwitchが起動してしまうだけになります。</p>

<p>ただ嬉しいことにタブ移動に関するキーはMacのアプリでももう一つあるので</p>

<ul>
  <li><i class="key">⌘</i>-<i class="key">TAB</i> to <i class="key">⌘</i>-<i class="key">⇧</i>-<i class="key">]</i></li>
  <li><i class="key">⌘</i>-<i class="key">⇧</i>-<i class="key">TAB</i> to <i class="key">⌘</i>-<i class="key">⇧</i>-<i class="key">[</i></li>
</ul>

<p>の置き換えをしてあげれば良いことになります。</p>

<p>Karabiner-Elementsであれば</p>

<pre><code>{
  "description": "Cmd-(Shift-)Tab to Cmd-Opt-Right(Left) (Select Next(Previous) Tab), 次(前)のタブを表示)",
  "manipulators": [
    {
      "type": "basic",
      "from": &lt;%= from("tab", ["command"]) %&gt;,
      "to": &lt;%= to([["close_bracket", ["command", "shift"]]]) %&gt;
    },
    {
      "type": "basic",
      "from": &lt;%= from("tab", ["command", "shift"]) %&gt;,
      "to": &lt;%= to([["open_bracket", ["command", "shift"]]]) %&gt;
    }
  ]
},
</code></pre>

<p>こんな感じで書けます。</p>

<p><a href="https://rcmdnk.com/KE-complex_modifications/">Karabiner-Elements complex_modifications rules by rcmdnk</a>
へ行って、<strong>Personal rules (@rcmdnk)をImportして
**Cmd-(Shift-)Tab to Cmd-Opt-Right(Left) (Select Next(Previous) Tab), 次(前)のタブを表示)</strong>を
Enableすることでもこの設定を入れることが出来ます。</p>

<h2 id="タブ移動キーを環境設定から設定する">タブ移動キーを環境設定から設定する</h2>

<p>Karabiner-Elementsを使わなくてもこれだけであれば
Macの環境設定からも設定できます。</p>

<p><strong>環境設定</strong><i class="fa fa-arrow-right"></i>
<strong>キーボード</strong><i class="fa fa-arrow-right"></i>
<strong>ショートカット</strong>へ行き
<strong>アプリケーション</strong>の欄で</p>

<ul>
  <li>次のタブを表示</li>
  <li>前のタブを表示</li>
  <li>Select Next Tab</li>
  <li>Select Previous Tab</li>
</ul>

<p>というメニュータイトルでそれぞれにキーボードショートカットを
決めてあげれば使えます。
全てのアプリケーションで共通にしたり、特定のアプリケーションに対して決める事もできます。</p>

<p>日本語のメニューのものには日本語で、英語メニューのものには英語で。
全体でするならとりあえず両方設定。</p>

<p>ここで設定するとFinderなどのウィンドウメニューにあるショートカットキーも変更されます。</p>

<p>元々のFinerのメニューでは</p>

<p><img src="https://rcmdnk.com/images/post/20171010_finderbefore.jpg" alt="finder before" class="pic" /></p>

<p>こんな感じですが、環境設定から</p>

<p><img src="https://rcmdnk.com/images/post/20171010_preferences.jpg" alt="preferences" class="pic" /></p>

<p>こんな感じのショートカットキーを追加してやると</p>

<p><img src="https://rcmdnk.com/images/post/20171010_finderafter.jpg" alt="finder after" class="pic" /></p>

<p>こんな感じでウィンドウメニューも変更されます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Vim emulation at Karabiner-ElementsでのSimultaneous keysなモード変換]]></title>
    <link href="https://rcmdnk.com/blog/2017/09/06/computer-mac-karabiner-vim/"/>
    <updated>2017-09-06T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2017/09/06/computer-mac-karabiner-vim</id>
    <content type="html"><![CDATA[<p><a href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/">前回</a>
紹介したKarabiner-Elementsを使ったVim emulationで
<i class="key">ESC</i>等のモード変換キーを切り分けて、
さらに<i class="key">J</i><i class="key">K</i>の同時押しなどSimultaneous keysによる
モード変換を入れました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#vim-emulationでの変換モードの切り分け" id="markdown-toc-vim-emulationでの変換モードの切り分け">Vim emulationでの変換モードの切り分け</a></li>
  <li><a href="#simultaneous-keysの設定方法" id="markdown-toc-simultaneous-keysの設定方法">Simultaneous keysの設定方法</a></li>
  <li><a href="#現状のsimultaneous-keysの問題点" id="markdown-toc-現状のsimultaneous-keysの問題点">現状のSimultaneous keysの問題点</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="vim-emulationでの変換モードの切り分け">Vim emulationでの変換モードの切り分け</h2>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170905_vimemu_120_90.jpg" width="120" height="90" alt="20170905_vimemu_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/">Vim以外でVimする: Mac+Karabiner-Elements編</a></div></li></ul>

<p><code>manipulators</code>のリストを別の<code>rule</code>として分けたとしても特に問題は無いので
分けただけ。</p>

<p>ただ、入力キーが被ると前の方が優先されるのでちょっと注意が必要です。</p>

<p>同じキーでも条件によって違う動作をする場合は複数の設定がありますが、
特定の条件では同じになるものもあって順序が逆になると動作がおかしくなるものがあります
<sup id="fninref:1"><a href="#fnin:1" rel="footnote">1</a></sup>。</p>

<p>今のところ</p>

<ul>
  <li>ESC to enter normal mode</li>
  <li>Ctrl-[ to enter normal mode</li>
  <li>Simultaneous jk to toggle normal-insert mode</li>
  <li>Simultaneous sd to toggle normal-insert mode</li>
  <li>Vim emulation core part</li>
</ul>

<p>の5つの設定がありますが、最後のものがVimライクな操作を設定するものなので必ず必要なもの。
後のはモードを変更するための設定でどれかをEnableすればOKです。</p>

<p>ただし、<strong>Simultaneous</strong>な2つの設定については
<i class="key">J</i>や<i class="key">S</i>がcoreの中で使われているので
<strong>Enable list</strong>の中で必ず<strong>Vim emulation core part</strong>より上にある必要があります。</p>

<h2 id="simultaneous-keysの設定方法">Simultaneous keysの設定方法</h2>

<p><strong>Simultaneous jk</strong>という設定は<i class="key">J</i>、<i class="key">K</i>を同時に押した時に
その効果が発動する設定です。</p>

<p><i class="key">J</i>や<i class="key">K</i>単独で押した時には通常の<i class="key">J</i>、<i class="key">K</i>もしくはそれに割り当てられた動作をします。</p>

<p>設定方法としては、まず<i class="key">J</i>についてのマッピングで、</p>

<ul>
  <li><code>to</code>に<code>set_variable</code>で適当な変数の値を変える</li>
  <li><code>to_if_alone</code>に本来の<i class="key">J</i>の機能を与える(何もしてないなら<code>"key_code": "j"</code>)。</li>
  <li><code>to_after_key_up</code>に変数の値を戻す設定をする。</li>
</ul>

<p>次に<i class="key">K</i>に</p>

<ul>
  <li><code>conditions</code>で<code>variable_if</code>の設定を行い、上で変更した変数の条件を設定して行いたい動作を与える。</li>
</ul>

<p>な感じでやっています。</p>

<p>下のものはちょっと省略したものですが、Simultaneous jkの設定です。</p>

<p>Normal-Insertのトグルなので<i class="key">J</i>、<i class="key">K</i>についてそれぞれ2つずつの設定があります。</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span></span><span class="p">{</span>
</span><span class="line">  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Simultaneous jk to toggle normal-insert mode&quot;</span><span class="p">,</span>
</span><span class="line">  <span class="nt">&quot;extra_description_level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class="line">  <span class="nt">&quot;manipulators&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;j&quot;</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_simul&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;to_if_alone&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;down_arrow&quot;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;to_after_key_up&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_simul&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;frontmost_application_unless&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;bundle_identifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">          <span class="err">...</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable_if&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_normal&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">},</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;j&quot;</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_simul&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;to_if_alone&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;j&quot;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;to_after_key_up&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_simul&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;frontmost_application_unless&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;bundle_identifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">          <span class="err">...</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable_unless&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_insert&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">},</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_normal&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_insert&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;frontmost_application_unless&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;bundle_identifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">          <span class="err">...</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable_if&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_simul&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable_if&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_normal&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">},</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="nt">&quot;from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nt">&quot;key_code&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span>
</span><span class="line">      <span class="p">},</span>
</span><span class="line">      <span class="nt">&quot;to&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_normal&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;set_variable&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="line">            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_insert&quot;</span><span class="p">,</span>
</span><span class="line">            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">],</span>
</span><span class="line">      <span class="nt">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;frontmost_application_unless&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;bundle_identifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="line">          <span class="err">...</span>
</span><span class="line">          <span class="p">]</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable_if&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_simul&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="line">        <span class="p">},</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable_unless&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vim_emu_insert&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">      <span class="p">]</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">  <span class="p">]</span>
</span><span class="line"><span class="p">}</span><span class="err">,</span>
</span></code></pre></td></tr></table></div></figure>

<h2 id="現状のsimultaneous-keysの問題点">現状のSimultaneous keysの問題点</h2>

<p>実際にはちょっと完璧な設定ではなく、
<i class="key">J</i>を押している間に<i class="key">K</i>が押されたらその動作をする、という設定です。</p>

<p>先に<i class="key">K</i>を押して<i class="key">J</i>を押すと発動しません。</p>

<p>なのでちょっと使うにしても慣れる必要があるかもしれません。</p>

<p>また、このキー設定をしてしまうと、
<i class="key">J</i>のリピート入力
(<i class="key">J</i>を押しっぱなしにした時に<code>jjjjjj...</code>と書き込む事)
ができなくなります。</p>

<p>Vim emulationのノーマルモードでも<i class="key">J</i>を押しっぱなしで
下に移動を続ける、ということが出来なくなります。</p>

<p>なので(Vimでは)余り押しっぱなしで使うことのないsdの方が使い勝手が良いかもしれません。</p>

<p>そもそもこの<code>to_if_alone</code>等の設定がSimultaneous keys用に作られたものでも無いと思いますが、
そのうち別に<code>simultaneous: ..</code>みたいな設定が出来る様になるかもしれません。
(もしかすると既にその手の設定が既に出来る様になってるかもしれませんが。)</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Vim以外でVimする: Mac+Karabiner-Elements編]]></title>
    <link href="https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim/"/>
    <updated>2017-09-05T00:00:00+00:00</updated>
    <id>https://rcmdnk.com/blog/2017/09/05/computer-mac-karabiner-vim</id>
    <content type="html"><![CDATA[<p>Karabiner-Elementsで色々出来る事が分かったので
これを使ってVim以外の場所でもVimの様な動作を出来る設定を
Karabiner-Elementsで作りました。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#やりたいこと" id="markdown-toc-やりたいこと">やりたいこと</a></li>
  <li><a href="#vim-emulationのインストール" id="markdown-toc-vim-emulationのインストール">Vim emulationのインストール</a></li>
  <li><a href="#有効になるアプリ" id="markdown-toc-有効になるアプリ">有効になるアプリ</a></li>
  <li><a href="#使い方" id="markdown-toc-使い方">使い方</a></li>
  <li><a href="#作り方" id="markdown-toc-作り方">作り方</a></li>
  <li><a href="#今後出来そうなこと" id="markdown-toc-今後出来そうなこと">今後出来そうなこと</a></li>
</ul>
<div class="group"></div>

<div class="center_wrapper">
  <div>Sponsored Links</div>
  <div>
  <ins class="adsbygoogle google-img-rect" style="display:inline-block" data-ad-client="ca-pub-3802317723662375" data-ad-slot="7116417646"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
</div>

<h2 id="やりたいこと">やりたいこと</h2>

<p>やりたいことはEvernoteとかでものを書く時に
Evernoteのアプリ上でVimっぽい操作をしたい、ということ。</p>

<p>Vimっぽい操作、というのは単に<i class="key">H</i>で左、
とかだけではなくてノーマルモードやビジュアルモードと言った
モード変換や<i class="key">Y</i><i class="key">Y</i>でコピー、<i class="key">P</i>でペースト
とか一通りの事が出来る様にする、というもの。</p>

<p>以前、Karabiner(KeyRemap4Macbook)の時も作って使っていました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2013/06/10/computer-mac-keyremap4macbook-vim/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/MacApp/thumbnail/vim_120_90.png" width="120" height="90" alt="vim_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/06/10/computer-mac-keyremap4macbook-vim/">Vim以外でVimする: Mac編</a></div></li></ul>

<p>これはKarabinerの本体の設定にも組み込まれてます。</p>

<p>また、WindowsでもAutoHotkeyを使って再現したものを今は使っています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2013/08/03/computer-windows-autohotkey/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20130723_AutoHotKey_120_90.jpg" width="120" height="90" alt="20130723_AutoHotKey_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/08/03/computer-windows-autohotkey/">Vim以外でVimする: Windows+AutoHotkey編</a></div></li></ul>

<p>こちらはAutoHotkeyが入って無くてもレポジトリにあるexeファイルを走らせればそれだけでも使えます。</p>

<p>その前にはyamyを使って作ってたりしました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2013/03/17/vim/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/MacApp/thumbnail/vim_120_90.png" width="120" height="90" alt="vim_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2013/03/17/vim/">Vim以外でVimする: Windows編</a></div></li></ul>

<p>モードの設定とかがあるのでちょっと複雑で書くことも沢山になりますが、
Karabinerで<code>set_variable</code>という機能で状態を変化させる事が出来る様になったことと、
KE-complex_modificationsを使ってJSONファイルを簡潔な記述で作れる様になったので
Karabiner-Elementsでも作ってみました。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/08/25/computer-mac-karabiner/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170825_karabinerelements0_120_90.jpg" width="120" height="90" alt="20170825_karabinerelements0_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/08/25/computer-mac-karabiner/">Karabiner-Elementsが大分進化してVi Modeとかまで出来る様になっていた</a></div></li></ul>

<h2 id="vim-emulationのインストール">Vim emulationのインストール</h2>

<p>インストール(インポート)は以下のページから出来ます。</p>

<blockquote>
  <p><a href="https://rcmdnk.com/KE-complex_modifications/">Karabiner-Elements complex_modifications rules by rcmdnk</a></p>
</blockquote>

<p><img src="https://rcmdnk.com/images/post/20170905_vimemu.jpg" alt="vimemu" class="pic" /></p>

<p><strong>Vim emulation</strong>の<code>Import</code>を押せばKarabiner-ElementsでImport出来ます。</p>

<p>出来たら追加された<strong>Vim emulation</strong>を<code>Enable</code>してください。</p>

<h2 id="有効になるアプリ">有効になるアプリ</h2>

<p>ターミナル、Vim、Emacs、ブラウザ、Remote Desktop、Virtual Machine
に関するアプリの上では無効になります。</p>

<p>それ以外では有効になります。
とりあえずテキストエディットとか立ち上げて試して見ると分かりやすいと思います。</p>

<h2 id="使い方">使い方</h2>

<p>使い方は基本的なVi(Vim)の動作と同じです。</p>

<p>ちょっと違うところとしては基本的に最初はインサートモード、つまりMacの普通の状態です。</p>

<p><i class="key">ESC</i>か<i class="key">⌃</i>-<i class="key">[</i>を押すとノーマルモードに入ります。</p>

<p>ノーマルモードでは<i class="key">H</i>で左に動いたり<i class="key">W</i>でワードジャンプ、
<i class="key">Y</i><i class="key">Y</i>でラインコピー、
<i class="key">P</i>でペースト、等が出来ます。</p>

<p><i class="key">V</i>を押せばビジュアルモードに入って移動するとその間のテキストを選択して、
<i class="key">Y</i>でコピー、<i class="key">D</i>を押せば切り取りとかが出来ます。</p>

<p>その他全ての現在有効な機能については以下を参照:</p>

<blockquote>
  <p><a href="https://github.com/rcmdnk/KE-complex_modifications/blob/master/docs/vim_emu.md">KE-complex_modifications/vim_emu.md at master · rcmdnk/KE-complex_modifications</a></p>
</blockquote>

<p>検索やちょっとしたコマンドモードのショートカットキーもあるので
Vimで出来るかなりの事が再現できてると思います。</p>

<p><code>3l</code>と打った時に右に3つ動く、と言ったことも出来ます。
(ただし1-9まで。)</p>

<h2 id="作り方">作り方</h2>

<p><a href="https://github.com/pqrs-org/KE-complex_modifications">pqrs-org/KE-complex_modifications</a>
をフォークしてERB形式で元ファイルを書いて
<strong>scripts/erb2json.rb</strong>で変換する形でJSONファイルを作っています。</p>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/08/30/computer-mac-karabiner/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170830_vimode_120_90.jpg" width="120" height="90" alt="20170830_vimode_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/08/30/computer-mac-karabiner/">KE-complex_modificationsを使ってKarabiner-Elementsの定義を色々作って公開する</a></div></li></ul>

<ul class="post_card"><li class="index_click_box"><div class="group"><div class="title-small-thumbnail">
  <a href="https://rcmdnk.com/blog/2017/09/01/computer-mac-karabiner/"><img class="small-thumbnail-img" src="https://rcmdnk.com/images/post/thumbnail/20170901_kedescription_120_90.jpg" width="120" height="90" alt="20170901_kedescription_120_90" /></a>
</div><a class="click_box_link" href="https://rcmdnk.com/blog/2017/09/01/computer-mac-karabiner/">Karabiner-Elements用のKE-complex_modificationsのextra_descriptionsを自動で生成する</a></div></li></ul>

<p><a href="https://github.com/rcmdnk/KE-complex_modifications/blob/master/scripts/erb2json.rb">rcmdnk/KE-complex_modifications/erb2json.rb</a>
が改造したスクリプトですが
vim_emu専用コマンドも作って
ERBファイルの方でなるべく簡潔に書ける様にしています。</p>

<p>特に移動コマンドに関してはノーマルモードとビジュアルモードで
同じ様な動作をしたりするのでその辺を簡単に書ける様にしたり。</p>

<p>これのおかげで元ファイルはコメントとか余計なのを含めても500行以下で済みました。
出来上がったJSONファイルは20万行近く(5MB程)あります。。。</p>

<p>手元の環境ではこれだけの設定を読み込んでも特に動作に問題は無いようなので
大丈夫かな、と。</p>

<p>嫌なら簡単に元の設定ファイル毎消すのも今回のKarabiner-Elementsであれば簡単なので
それ程気にしなくてもよいかな、と。</p>

<p>Karabinerの時には設定を公式本体に組み込んでしまうと、それが原因で動作がもっさりすることがあったりしたのであれでしたが。</p>

<h2 id="今後出来そうなこと">今後出来そうなこと</h2>

<p><i class="key">ESC</i>をノーマルモード入りに使ってますが、
アプリによっては<i class="key">ESC</i>が重要だったりするかもしれないので
他のキーにしたい場合もあるかもしれません。</p>

<p>そういった時に選べる様にここだけ切り離した方が良いかな？とも。</p>

<p>まあ、<strong>~.config/karabiner/karabiner.json</strong>を直接編集(<code>escape</code>で探して)すればすぐに変更出来ますが。
(ただ、vim_emuのせいで非常に大きくなってるのでちょっと注意。。。)</p>

<p>後はKarabiner-Elements本体の方で、
<code>repeat</code>という新しい機能をつけて</p>

<pre><code>  "to": [
      {   "repeat": 5,
          "action": [
              {
                  "key_code": "a",
                  "repeat": 10
              },
              {
                  "key_code": "b",
                  "repeat": 10
              }
          ]
      }
  ],
</code></pre>

<p>みたいな感じで各キーの繰り返しや、<code>to</code>全体の繰り返しとか出来る様になったら
かなりvim_emuの記述を減らす事が出来るので
ちょっとできそうなものか見てできそうならプルリクエスト作ったりしたいと思います。</p>

<p>同様にアプリの定義とか、今は全ての設定それぞれに同じ事を繰り返し各必要がありますが、
JSONファイルの中でエイリアス的な設定をしてそれを呼べる様に出来たら
また大分書き込みが減るかな、と。
変更したい時もJSONファイルの編集で簡単に出来ますし。
(いまだと何百箇所となおさないといけないので。)
アプリだけでなく特定のコマンドとかも。</p>

<p>KE-complex_modificationsを使うことで作業としてはその辺簡単に出来てますが、
実際吐き出されるJSONが大きいのでなんとか出来れば嬉しいな、というところです。</p>

<p>その他もし何かあれば
<a href="https://github.com/rcmdnk/KE-complex_modifications">rcmdnk/KE-complex_modifications</a>
の方にIssuesとか投げて貰えればうれしいです。</p>
]]></content>
  </entry>
  
</feed>
