<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Prompt | rcmdnk's blog]]></title>
  <link href="http://rcmdnk.github.io/blog/tags/prompt/atom.xml" rel="self"/>
  <link href="http://rcmdnk.github.io/"/>
  <updated>2013-08-18T16:32:46+02:00</updated>
  <id>http://rcmdnk.github.io/</id>
  <author>
    <name><![CDATA[rcmdnk]]></name>
    <email><![CDATA[rdmdnk@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Macのターミナル.appでのPROMPT_COMMAND]]></title>
    <link href="http://rcmdnk.github.io/blog/2013/05/01/computer-mac-bash-prompt/"/>
    <updated>2013-05-01T16:03:00+02:00</updated>
    <id>http://rcmdnk.github.io/blog/2013/05/01/computer-mac-bash-prompt</id>
    <content type="html"><![CDATA[<p>Macでは普段iTerm2を使っているのですが、
ふと、もともと入ってるターミナル.appを立ち上げた所、
<code>PROMPT_COMMAND</code>がおかしくてエラーがでたので修正しました。</p>

<!-- more -->


<p><br class="clearBoth">

<h1>Contents</h1>
{:TOC}

<script type="text/javascript"><!--
google_ad_client = "ca-pub-3802317723662375";
/* imgRectMid */
google_ad_slot = "9043394444";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>



</p>

<h1 id="`.bashrc`での`PROMPT_COMMAND`の設定"><code>.bashrc</code>での<code>PROMPT_COMMAND</code>の設定</h1>

<p>自分用の<code>.bashrc</code>内で、いくつか</p>

<pre><code>PROMPT_COMMAND="${PROMPT_COMMAND:+${PROMPT_COMMAND};}command"
</code></pre>

<p>という形で新しい<code>command</code>を<code>PROMPT_COMMAND</code>に追加しています。<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup></p>

<p>これは、<code>PROMPT_COMMAND</code>に何らかのコマンドがあれば、最後に<code>;</code>を加えて
新しいコマンドを付け加える、というつもりで、
前提として<code>PROMPT_COMMAND</code>の最後に<code>;</code>がついてないということがありました。</p>

<h1 id="ターミナル.app上での`PROMPT_COMMAND`">ターミナル.app上での<code>PROMPT_COMMAND</code></h1>

<p>Macのターミナル.appには新しいウィンドウやタブを開くとき、
現在作業中の所と同じディレクトリで開く事が出来るオプションがあります。</p>

<p><img src="/images/post/20130501_terminalsetting.jpg" title="" alt=""></p>

<p>このディレクトリの定義はエスケープシーケンスを使って保存していて、
<code>/etc/.bashrc</code>を見ると</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>/etc/bashrc </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1 id="System-wide+.bashrc+file+for+interactive+bash(1)+shells.">System-wide .bashrc file for interactive bash(1) shells.&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>if [ -z "$PS1" ]; then
</span><span class='line'>   return
</span><span class='line'>fi&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>PS1='\h:\W \u\$ '&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1 id="Make+bash+check+its+window+size+after+a+process+completes">Make bash check its window size after a process completes&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>shopt -s checkwinsize&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1 id="Tell+the+terminal+about+the+working+directory+at+each+prompt.">Tell the terminal about the working directory at each prompt.&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>if [ "$TERM_PROGRAM" == "Apple_Terminal" ] &amp;&amp; [ -z "$INSIDE_EMACS" ]; then&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>update_terminal_cwd() {
</span><span class='line'>    # Identify the directory using a "file:" scheme URL,
</span><span class='line'>    # including the host name to disambiguate local vs.
</span><span class='line'>    # remote connections. Percent-escape spaces.
</span><span class='line'>local SEARCH=' '
</span><span class='line'>local REPLACE='%20'
</span><span class='line'>local PWD_URL="file://$HOSTNAME${PWD//$SEARCH/$REPLACE}"
</span><span class='line'>printf '\e]7;%s\a' "$PWD_URL"
</span><span class='line'>}
</span><span class='line'>PROMPT_COMMAND="update_terminal_cwd; $PROMPT_COMMAND"
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>fi</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>と言った様になっていて、<code>update_terminal_cwd</code>と言う関数内で
<code>\e]7;~\a</code>にディレクトリ情報を送り、この情報をターミナル.appは使っている様です。
この関数を<code>PROMPT_COMMAND</code>で呼んでいます。</p>

<p>従って、上のターミナル.appの環境設定の一番下にもある注意の様に、もし<code>.bashrc</code>
等で<code>PROMPT_COMMAND</code>を上書きしてこの設定を消してしまえば
この環境設定で<code>同じ作業ディレクトリ</code>を選んでも機能しなくなります。</p>

<p>この設定は<code>TERM_PROGRAM</code>が<code>Apple_Terminal</code>(ターミナル.app)
の場合(かつemacs内でのshellで無い場合)
のみに加わるのでiTerm等、他のターミナルアプリでは
<code>/etc/bashrc</code>は<code>PS1</code>を設定するのみになります。</p>

<h1 id="問題点">問題点</h1>

<p>問題なのは</p>

<pre><code>PROMPT_COMMAND="update_terminal_cwd; $PROMPT_COMMAND"
</code></pre>

<p>となっている部分で、この時点で<code>PROMPT_COMMAND</code>が定義されていないと、
結果的に</p>

<pre><code>PROMPT_COMMAND="update_terminal_cwd;"
</code></pre>

<p>と言う様に最後が<code>;</code>で終わる形になってしまいます。</p>

<p>このまま上のある様に<code>;</code>をさらに付け加えてしまうと</p>

<pre><code>-bash: syntax error near unexpected token `;'
</code></pre>

<p>の様なエラーが毎回コマンド打つ事に出て来るようになってしまいます。</p>

<p>普段使ってるLinux(Redhat系)では<code>/etc/bashrc</code>内で</p>

<pre><code>PROMPT_COMMAND='printf "\033]0;%s@%s:%s\007" "${USER}" "${HOSTNAME%%.*}" "${PWD/#$HOME/~}"'
</code></pre>

<p>と言った様に最後が<code>;</code>で無い形で終わっているので
両者で動かすためにちょっと修正が必要です。</p>

<h1 id="`.bashrc`の修正"><code>.bashrc</code>の修正</h1>

<p><code>.bashrc</code>の先頭の方で次の様にしました。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>.bashrc </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>...&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1 id="In+Mac,+it+is+already+read.">In Mac, it is already read.&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>if [[ ! "$OSTYPE" =~ "darwin" ]];then
</span><span class='line'>  if [ -r /etc/bashrc ];then&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>source /etc/bashrc
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>  fi
</span><span class='line'>fi&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1 id="Remove+the+last++;++from+PROMPT_COMMAND">Remove the last ";" from PROMPT_COMMAND&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>PROMPT_COMMAND=&lt;code>echo ${PROMPT_COMMAND}|sed 's/;$//'&lt;/code>
</span><span class='line'>...&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1 id="}}}">}}}&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><code>/etc/bashrc</code>を読み込んだ後に<code>PROMPT_COMMAND</code>の最後の<code>;</code>を取り除いています。</p>

<p>また、<code>.bashrc</code>の最初で<code>/etc/bashrc</code>を読み込むのですが、
Macの場合、新しいシェルの立ち上げ時に自動的に<code>/etc/bashrc</code>が
読み込まれる様で、上にある<code>update_terminal_cwd</code>が2重に
記述されていたので、
Macの場合(<code>"$OSTYPE" =~ "darwin"</code>)では<code>.bashrc</code>内からは
読み込まない様にもしました。</p>

<p>あまりこの辺の情報を探しても見つからなかったのですし、
<code>Macのターミナルの使い方</code>的な話でも普通に<code>/etc/bashrc</code>を
呼ぶ様な<code>.bashrc</code>を紹介しているようなページしか
見当たらなかったのですが、あまり気になる所ではないですかね...
(ま、今回まで自分も気付かなかったわけだし...)</p>

<h1 id="その他">その他</h1>

<p>と、今回気付いた点のもう一つが、普段使っているLinuxの方では上にあるように
<code>PROMPT_COMMAND</code>で
ウィンドウのタイトル、アイコン名(<code>\033]0;~\007</code>)を変更するように
<code>/etc/bashrc</code>内で設定している事です。</p>

<p>そういえばそうだった、という感じで、昔見た覚えがありますが、
最近これを<code>PS1</code>の変数内で行なっているので、2重に行なっていることになります。</p>

<p><code>PS1</code>の方が後に実行されるので問題は無いのですが、ちょっと気持ち悪い。
ただ、<code>PROMPT_COMMAND</code>にしても、後に付け加えれば2重になるので、
以前、その様に設定してた時も同じと言えば同じです。</p>

<p>基本的にはどこでも事前に設定されているコマンドが必要な事は
殆ど無いので、いっその事<code>.bashrc</code>内で1回リセットしてしまっても
良いのかもしれませんが、
今回のターミナルの様に特殊に使ってる場合もあるということが分かったので、
差し当たりそのままにしておきます。</p>

<hr />

<p><div class="footnotes">
	<ol>
		<li id='fn:1'><p> <code>${A:+B}</code>でAが定義されてない、またはNULL(空)の場合にはNULLを返し、
  NULL以外の何らかの値が入っていればBを返します。
<a href='#fnref:1' rev='footnote'>↩</a></p>
</li>
	</ol>
</div>
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PS1とPROMPT_COMMAND, GNU screenでの活用も]]></title>
    <link href="http://rcmdnk.github.io/blog/2013/03/21/prompt-command/"/>
    <updated>2013-03-21T09:49:00+01:00</updated>
    <id>http://rcmdnk.github.io/blog/2013/03/21/prompt-command</id>
    <content type="html"><![CDATA[<p><a href="/blog/2013/03/18/prompt-screen">前回</a>プロンプトの事を書いたので、
ついでに<code>PROMPT_COMMAND</code>の設定についてメモしておきます。
GNU screenを起動させている時についても。</p>

<!-- more -->


<p><br class="clearBoth">

<h1>Contents</h1>
{:TOC}

<script type="text/javascript"><!--
google_ad_client = "ca-pub-3802317723662375";
/* imgRectMid */
google_ad_slot = "9043394444";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>



</p>

<h1 id="PROMPT_COMMAND">PROMPT_COMMAND</h1>

<p><code>bash</code>には<code>PROMPT_COMMAND</code>と言うシェル変数があり、この値に指定したコマンドが
各コマンド実行後に処理されます。</p>

<pre><code>PROMPT_COMMAND='echo command finish'
</code></pre>

<p>としておけば、毎回コマンド実行後に<code>command finish</code>が表示されます。
(<code>Enter</code>だけ押した場合にも。)</p>

<h1 id="PS1,+PS2,+PS3,+PS4">PS1, PS2, PS3, PS4</h1>

<h2 id="PS1">PS1</h2>

<p>さらに前回も使った<code>PS1</code>と言うシェル変数があり、この内容に書かれた物が
プロンプトとして</p>

<pre><code>[host:dir user]$
</code></pre>

<p>みたいな感じで表示されます。
他にも<code>PS2</code>、<code>PS3</code>、<code>PS4</code>と言うシェル変数があります。</p>

<h2 id="PS2">PS2</h2>

<p>セカンダリプロンプトとして使用され、入力を要求される様なコマンドや、複数行に渡るコマンドなどを使うときに表れます。初期値は<code>&gt;</code>になってます。</p>

<pre><code>[host:dir user]$ echo \
&gt;   &lt;-- this word
</code></pre>

<h2 id="PS3">PS3</h2>

<p><code>select</code>文を使った時に表示される文字です。初期値は空ですが<code>#?</code>
と言う値が表示されます。
<div><script src='https://gist.github.com/5213200.js'></script>
<noscript><pre><code></code></pre></noscript></div>

こんな感じのスクリプトを実行した時に出てくる</p>

<pre><code>(-_-) $ ./select_example.sh
1) Hello World
2) calculate 1+1
3) exit
#?  &lt;- this word
</code></pre>

<p>この<code>#?</code>部分です。</p>

<h2 id="PS4">PS4</h2>

<p>シェルスクリプトで<code>-x</code>オプションを使ったデバッグ時に出てくる文字です。
初期値は<code>+</code>。</p>

<p>```sh</p>

<pre><code>#!/bin/bash -x
echo ok

ech wrong

echo ok
</code></pre>

<p><code>``
このような</code>-x`付きのデバッグ用スクリプトを実行した時の</p>

<pre><code>+ echo ok
ok
+ ech wrong
./debug_test.sh: line 4: ech: command not found
+ echo ok
ok
</code></pre>

<p>この各スクリプト行の前に出る<code>+</code>の部分です。</p>

<p>通常は<code>PS1</code>以外を変更することは無いと思います。</p>

<h1 id="PS1とPROMPT_COMMANDの使い分け">PS1とPROMPT_COMMANDの使い分け</h1>

<p><code>PS1</code>は内容がプロンプトに表示されるだけなのに対して、
<code>PROMPT_COMMAND</code>では実際に色々と実行コマンドを行うためのシェル変数です。
<code>PROMPT_COMMAND</code>の方が<code>PS1</code>よりも先に実行されます。</p>

<p><code>PS1</code>内でも"&#96;"で囲ったり<code>$()</code>を使ったりすることでコマンドを実行できるので、
表示文字が無い様な実行コマンドであれば
PS1の中に入れることもできると思いますが、
<code>PROMPT_COMMAND</code>に書いておいた方がすっきりするかと思います。</p>

<p>逆に、<code>PROMPT_COMMAND</code>でも文字を表示させることができるのですが、
下に書くエスケープシーケンスの問題があったり、その他にも
一度書きだした後にバックスペースで消していくと消えてしまったりもするので
なるべく<code>PROMPT_COMMAND</code>による表示はやめておくべきだと思います。</p>

<p>さらに前回の顔文字の例だと、顔文字自体は適当なシェル変数にして<code>PROMPT_COMMAND</code>
で決めて <code>PS1</code>に送る事は出来ると思うのですが、
色指定のエスケープシーケンスを渡す事が上手くできなかったので
直接全部<code>PS1</code>内に書いています。</p>

<h1 id="プロンプトの表示">プロンプトの表示</h1>

<p>前回もやったことですが</p>

<pre><code>PS1="[\h \W]\$"
</code></pre>

<p>とすればプロンプトが<code>[host dirctory] $</code>の様になりますし、色を指定して</p>

<pre><code>PS1="\[\e[31m\][\h \W]\[\e]m\]\$"
</code></pre>

<p>とすれば表示部分が赤くなります。
色を変えるには<code>\e[</code>と<code>m</code>で囲った部分に数字を書きます<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>。
色などについては
どの数字がどのように表示されるかは
<a href="https://github.com/rcmdnk/scripts/blob/master/escseqcheck.sh">escseqcheck.sh</a>
このスクリプトを実行してみて下さい。
こんな感じの表示がされると思います(MacのiTerm2での結果です)<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>。
<img src="/images/post/20130321_escseqcheck.png"></p>

<p>さらに、この様な表示されない文字を表示上無視するために<code>\[</code>と<code>\]</code>
で文字色指定の部分を囲ってやる必要があります。
これをしなくても一見問題ないように見えますが、
コマンドを消去したり、過去のコマンドを<code>C-p</code>で遡ったりするときに
表示がおかしくなります。</p>

<p><code>PROMPT_COMMAND</code>内で<code>printf</code>等で表示しょうとした場合、
<code>\[</code>自体が表示されてしまい、色指定部分をちゃんと隠すことが出来ないので、
表示させるものについては<code>PS1</code>内に指定するべきです。</p>

<p>さらに、<code>PS1</code>の中では<code>\h</code>はホスト名など等、
特殊なエスケープシーケンス<sup id='fnref:3'><a href='#fn:3' rel='footnote'>3</a></sup>
が使えるので<code>PS1</code>内で行ったほうが簡単です。</p>

<h1 id="ターミナルのタイトルバーの表示">ターミナルのタイトルバーの表示</h1>

<p>ターミナルのタイトルバーは<code>\e]2;</code>、<code>\a</code>で囲った部分に書いた文字を書き出すことで
変更してあげることが出来ます。</p>

<pre><code>printf "\e]2;Hello World!\a"
</code></pre>

<p>とすればターミナル上にタイトルバーがる場合はそこへの表示が<code>Hello World!</code>に
変わると思います。ただ、これは<code>Xterm</code>仕様で、使っているターミナルによっては
違うこともあるようなので気をつけて下さい。
さらに、<code>\e]1;</code>を<code>\e]2;</code>の代わりに使うとアイコン名を変えられます。
アイコン名はタスクバーやDockにしまった時にそのWindow名として表れる名前です。
これらを一緒にしたければ<code>\e]0;</code>を使うことで同時に変えられます。</p>

<p>これを直接<code>PROMPT_COMMAND</code>に
```sh</p>

<pre><code>PROMPT_COMMAND='printf "\e]0;%s@%s:%s\a" "${USER}" "${HOSTNAME%%.*}" "${PWD/#$HOME/~}"'
</code></pre>

<p><code>
の様に書いても良いし、`PS1`に加えて
</code>sh</p>

<pre><code>PS1="\[\e]0;\u@\h\w\a\][\h \W]\$ "
</code></pre>

<p>```
の様に書いても同様の結果になります。</p>

<table>
<thead>
<tr>
<th align="center">エスケープシーケンス</th>
<th align="left">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>\e]0;</code> ~ <code>\a</code></td>
<td align="left">タイトル名、アイコン名の変更</td>
</tr>
<tr>
<td align="center"><code>\e]1;</code> ~ <code>\a</code></td>
<td align="left">アイコン名の変更</td>
</tr>
<tr>
<td align="center"><code>\e]2;</code> ~ <code>\a</code></td>
<td align="left">タイトル名変更</td>
</tr>
</tbody>
</table>


<h1 id="GNU+screen内での表示">GNU screen内での表示</h1>

<p>screenを立ち上げると、この辺りの話が少しややこしくなります。
screen内のウィンドウから<code>\e]0;</code>を送ると、各ウィンドウの<code>hardstatus</code>に送られます。
screenの設定で<code>caption</code>や<code>hardstatus</code>の表示設定で<code>%h</code>で表示される文字列です。</p>

<p>さらにscreen内の各ウィンドウには<code>タイトル</code>もあり、これは<code>caption</code>設定などでは
<code>%t</code>で設定されるものですが、これを設定するには
<code>\ek</code>と<code>\e\134</code>で囲った物を<code>printf</code>します。
ここで、<code>\134</code>は<code>\</code>と同義で、</code>PROMPT_COMMAND<code>内で
</code>\e\<code>と使う分には問題ないんですが</code>PS1<code>内で使おうとすると
</code>[<code>、</code>]<code>との組み合わせのなかで何故か</code>]<code>が表示される様に残ってしまうので
ここだけ8進法表示にしてあります。
(PS1内では何かしら</code>\<code>の後にエスケープシーケンスを使わなくてはいけないことに
どうしてもなってしまうので、どうも</code>\`となってしまう部分が微妙におかしくなって
しまいます。)</p>

<p>さらに、ターミナルそのもののタイトルをscreen内から変更したいときは
<code>\eP</code>と<code>\e\134</code>で囲った部分に上で書いたタイトルバー等のエスケープシーケンスを含んだ
情報を入れた送ってあげます。つまり</p>

<pre><code>printf "\eP\e]0;%s@%s:%s\a\e\134" "${USER}" "${HOSTNAME%%.*}" "${PWD/#$HOME/~}"
</code></pre>

<p>の様にしてあげるとターミナルそのもののタイトルバーとアイコン名を変更して
あげることが出来ます。</p>

<table>
<thead>
<tr>
<th align="center">エスケープシーケンス(screen内)</th>
<th align="left">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>\e]0;</code> ~ <code>\a</code></td>
<td align="left">ウィンドウのハードステータス</td>
</tr>
<tr>
<td align="center"><code>\ek</code> ~ <code>\e\134</code></td>
<td align="left">ウィンドウのタイトル</td>
</tr>
<tr>
<td align="center"><code>\eP</code> ~ <code>\e\134</code></td>
<td align="left">screen外へ情報を送る</td>
</tr>
</tbody>
</table>


<p>現在のscreen起動時のprompt設定はこんな感じです。
ターミナルの表示は変えずに、screenに入った場所のままになります。
(新規ウィンドウを立ち上げる場所にあたるので
たまに立ち上げた場所自体が気になるので)
<div><script src='https://gist.github.com/5216260.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>

<p>Gistの方はアップデートしないかもしれませんので、一応普段使っている<code>.bashrc</code>
の場所も:<a href="https://github.com/rcmdnk/dotfiles/blob/master/.bashrc">.bashrc</a></p>

<p>screenの方では次の様な設定にしてあります。</p>

<pre><code>caption always '%?%F%{=d Wk}%:%{=d Kk}%?%?%P%{=d Bk}%:%?%2n %h%-0L&gt;%=%?%P *** copy/paste mode ***%:%?%-0='
hardstatus alwayslastline "%{= Kk}%-w%40L&gt;%{= Wk}%n %t%{-}%+w"
</code></pre>

<p>上記の設定の意味や、他の設定も含めたファイルはこちら
<a href="https://github.com/rcmdnk/dotfiles/blob/master/.screenrc">.screenrc</a>.</p>

<h1 id="おまけ">おまけ</h1>

<p><code>$HOME</code>に置いておくと、さよならしてくれます。</p>

<p><div><script src='https://gist.github.com/5223123.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>

<hr />

<p><div class="footnotes">
	<ol>
		<li id='fn:1'><p> ここでは<code>\e</code>と使ってますがこれは<code>\033</code>と書いてあげることもできます。
  エスケープシーケンスの記号と数字の関係はwikiの
  <a href="http://ja.wikipedia.org/wiki/ASCII">ASCII</a>の項目で。</p></p>

<p>  <a href='#fnref:1' rev='footnote'>↩</a>

</li><li id='fn:2'><p> <code>30-38</code>が文字色<code>40-48</code>が背景色の設定です。
  複数の指定も<code>;</code>で繋げる事により可能で、
  <code>1-10</code>と同時に組み合わせると環境によって太字になったり明るくなったりします
  (上の絵では明るくなっています。) 1-9は</p></p>

<table>
<thead>
<tr>
<th align="center">  数字</th>
<th align="left">変化</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">  1</td>
<td align="left">太字、または明るい色</td>
</tr>
<tr>
<td align="center">  2</td>
<td align="left">細字、暗い色</td>
</tr>
<tr>
<td align="center">  3</td>
<td align="left">イタリック</td>
</tr>
<tr>
<td align="center">  4</td>
<td align="left">一本下線</td>
</tr>
<tr>
<td align="center">  5</td>
<td align="left">遅い点滅</td>
</tr>
<tr>
<td align="center">  6</td>
<td align="left">速い点滅</td>
</tr>
<tr>
<td align="center">  7</td>
<td align="left">反転</td>
</tr>
<tr>
<td align="center">  8</td>
<td align="left">隠し文字</td>
</tr>
<tr>
<td align="center">  9</td>
<td align="left">表示されるが消去されたものとしてターミナル上扱われる</td>
</tr>
</tbody>
</table>




<p>  となってますが、上の写真にあるように、環境によってはイタリックとかが表示される
  代わりに反転になったりします。
  点滅はiTermだとできませんでしたが、Macのターミナルなら遅い点滅は表示されました。</p>




<p>  10-20ではフォントを変えるので、場合によっては文字化けするかもしれません。
  (上のスクリプトではそれらのあとでは表示後に全て10(Default)に戻しています)</p>




<p>  <a href='#fnref:2' rev='footnote'>↩</a>

</li><li id='fn:3'><p><code>man bash</code>で全て確認出来ますが、良く使うのは次のようなものです。</p></p>

<table>
<thead>
<tr>
<th align="center">  エスケープシーケンス</th>
<th align="left">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">  \h</td>
<td align="left">ホスト名(最初の<code>.</code>まで)</td>
</tr>
<tr>
<td align="center">  \H</td>
<td align="left">ホスト名</td>
</tr>
<tr>
<td align="center">  \t</td>
<td align="left">現在時刻(24h, HH:MM:SS)</td>
</tr>
<tr>
<td align="center">  \u</td>
<td align="left">ユーザーネーム</td>
</tr>
<tr>
<td align="center">  \w</td>
<td align="left">ディレクトリ名(パス含む)、$HOMEは<code>~</code>に変換</td>
</tr>
<tr>
<td align="center">  \W</td>
<td align="left">現在のディレクトリ名のみ、$HOMEは<code>~</code>に変換</td>
</tr>
</tbody>
</table>




<p><a href='#fnref:3' rev='footnote'>↩</a>

</li>
	</ol>
</div>
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[プロンプトの戯れ]]></title>
    <link href="http://rcmdnk.github.io/blog/2013/03/18/prompt-screen/"/>
    <updated>2013-03-18T18:39:00+01:00</updated>
    <id>http://rcmdnk.github.io/blog/2013/03/18/prompt-screen</id>
    <content type="html"><![CDATA[<p>最近色々<code>.bashrc</code>だとか整理している時に、プロンプトの表示を変更しようと思い、
結局何が必要なのか考えたのですが、
普通、ディレクトリ名やユーザー名、ホスト名などを入れていると思いますが、
普段は<a href="http://www.gnu.org/software/screen/">GNU screen</a>を使っていて、
常に各領域にディレクトリパスも表示させてるので、プロンプトに情報を表示
させとく必要が特に無いわけです。
そこで、プロンプト表示でちょっと遊んでみました。</p>

<!-- more -->


<p><br class="clearBoth">

<h1>Contents</h1>
{:TOC}

<script type="text/javascript"><!--
google_ad_client = "ca-pub-3802317723662375";
/* imgRectMid */
google_ad_slot = "9043394444";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>



</p>

<h1 id="これまでのプロンプト">これまでのプロンプト</h1>

<p>ここでは<code>bash</code>での話です。
プロンプトは<code>PS1</code>というシェル変数を変更してやることで表示を変えてやることが出来ます。</p>

<p>手元の環境だと、デフォルトでは<code>/etc/bashrc</code>内で次のように設定されています。</p>

<p>{:lang=:ruby"}</p>

<pre><code># System-wide .bashrc file for interactive bash(1) shells.
if [ -z "$PS1" ]; then
   return
fi

PS1='\h:\W \u\$ '
</code></pre>

<p><code>\h</code>がホスト名、<code>\W</code>がカレントディレクトリ、<code>\u</code>でユーザー名です(他のオプションは<code>man bash</code>)。
従って、ホームディレクトリで操作していると</p>

<pre><code>hostname:~ username$
</code></pre>

<p>の様な表示になるはずです。</p>

<p>これまで自分の設定では<code>PS1="[\h \W]\$ "</code>と<code>.bashrc</code>で指定してました。</p>

<pre><code>[hostname ~]$ 
</code></pre>

<p>的な感じでした。</p>

<h1 id="顔文字にしてみる">顔文字にしてみる</h1>

<p>単純に変更するだけなら</p>

<pre><code>hostname:~ user$ PS1='(-_-) \$ '
(-_-) $
(-_-) $
</code></pre>

<p>こんなかんじで、以後ずっと<code>(-_-)</code>になります。</p>

<p>これだけだと味気ないので直前のコマンドが実行がエラー(0以外)を吐いたときは
違う表示をさせてやりたいと思います。</p>

<pre><code>(-_-) $ PS1="\$(\
&gt;   ret=\$?
&gt;   if [ \$ret -eq 0 ];then\
&gt;     printf '\[\e[m\](^_^)\[\e[m\] \$ ';\
&gt;   else\
&gt;     printf '\[\e[31m\](@o@)\[\e[m\] \$ ';\
&gt;   fi;\
&gt;   )"
(^_^) $ echo

(^_^) $ eeeeee
bash: eeeeee: command not found
(@o@) $
(@o@) $ echo

(^_^) $
(^_^) $
</code></pre>

<p><code>$()</code>を使って<code>PS1</code>の設定の中にコマンドを持ち込んでいます。
<code>$?</code>で直前のコマンドの返り値を見て、<code>0</code>なら<code>(^_^)</code>、それ以外なら<code>(@o@)</code>
を赤で表示させています。</p>

<p>何も入力しないで<code>Enter</code>した場合は前の状態が残るので直前と同じ顔が出ます。</p>

<p>顔文字の両側にある<code>\[e[31m]</code>などが色を変更している部分です。
後ろの<code>\[\e[m\]</code>の部分は設定をリセットしています。
書く数字でどのように表示されるかは
<a href="https://github.com/rcmdnk/scripts/blob/master/escseqcheck.sh">escseqcheck.sh</a>
というスクリプトもあるので参考にしてみて下さい。
(ちょっとした自分用の説明もファイル内に書いてあります。)</p>

<h1 id="ランダムに顔を変えてみる">ランダムに顔を変えてみる</h1>

<p>上記の前コマンドの返り値に加えて、乱数で条件分岐させてやることで
毎回違った顔を楽しめるようにしてみます。</p>

<p><div><script src='https://gist.github.com/5198842.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>

<p>こんな感じの設定で毎回違った顔が楽しめるようになります。
<code>$RANDOM</code>は参照するたびに0-32767までのランダムな整数を返します。
<code>bash</code>では一番簡単な乱数の取得だと思うので、今回はこれを使いました。
後は、36パターンの状態を作りだして、適当な割合で
各顔文字に割り当てているだけです。</p>

<p>こんな感じになります。</p>

<p><img src="/images/post/20130318_prompt.gif" title="" alt=""></p>

<blockquote><p>Ref.: <a href="http://maketecheasier.com/8-useful-and-interesting-bash-prompts/2009/09/04">8 Useful and Interesting Bash Prompts</a></p></blockquote>
]]></content>
  </entry>
  
</feed>
